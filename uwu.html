<!DOCTYPE html>
<html>
  <head>
    <title>Canvas Drawing App</title>
    <style>
      #canvas {
        border: 1px solid black;
        margin: 0 auto;
        display: block;
      }
      #options {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 10px;
      }
      label {
        margin-right: 10px;
      }
      .color {
        width: 30px;
        height: 30px;
        margin-right: 10px;
        cursor: pointer;
        border: 1px solid black;
      }
      .color:hover {
        opacity: 0.7;
      }
      #customColor {
        width: 60px;
        height: 30px;
        padding: 0 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        margin-right: 10px;
      }
      #customColorPicker {
        display: flex;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .customColorSwatch {
        width: 30px;
        height: 30px;
        margin-right: 10px;
        margin-bottom: 10px;
        cursor: pointer;
        border: 1px solid black;
      }
      .customColorSwatch:hover {
        opacity: 0.7;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="500" height="500"></canvas>
    <div id="options">
      <div id="colorwrap">
        <label for="colorPicker">Color:</label>
        <input type="color" id="colorPicker" value="#000000">
        <div class="sorted">
          <div class="color"id="rainbowButton" style="width: 30px; height: 30px; background: linear-gradient( to bottom right,rgb(255, 122, 122),rgb(255, 255, 26),rgb(141, 255, 141),rgb(112, 112, 255),rgb(215, 160, 255),violet); cursor: pointer;"></div>
          <div id="standardColors">
            <div class="color" style="background-color: #000000;"></div>
            <div class="color" style="background-color: #FF0000;"></div>
            <div class="color" style="background-color: #00FF00;"></div>
            <div class="color" style="background-color: #0000FF;"></div>
            <div class="color" style="background-color: #FFFF00;"></div>
            <div class="color" style="background-color: #FF00FF;"></div>
            <div class="color" style="background-color: #00FFFF;"></div>
            <div class="color" style="background-color: #FFFFFF;"></div>
            <div class="color" style="background-color: #FFA500;"></div>
            <div class="color" style="background-color: #800080;"></div>
          </div>
        </div>
        <label for="brushSize">Brush Size:</label>
        <input type="range" id="brushSize" min="1" max="150" value="10">
        <br>
        <label for="brushOpacity">Opacity:</label>
        <input type="range" id="brushOpacity" min="1" max = "255" value="255">
      </div>
      <div id="drawShowHideButton">Show Drawing</div>
      <div id="sliderWrapper">
        <label for="hue">Hue:</label>
        <input type="range" id="hue" min="-180" max="180" value="0">
        <br>
        <label for="blur">Blur:</label>
        <input type="range" id="blur" min="0" max="10" step="0.1" value="0">
        <br>
        <label for="contrast">Contrast:</label>
        <input type="range" id="contrast" min="0" max="200"  value="100">
        <br>
        <label for="exposure">Exposure:</label>
        <input type="range" id="exposure" min="-5" max="5" step="0.1" value="0">
        <br>
        <label for="brightness">Brightness:</label>
        <input type="range" id="brightness" min="0" max="200" value="100">
        <br>
        <label for="saturation">Saturation:</label>
        <input type="range" id="saturation" min="0" max="200" value="100">
        <br>
        <label for="grayscale">Gray-scale:</label>
        <input type="range" id="grayscale" min="0" max="100" value="0">
        <br>
        <label for="invert">Invert</label>
        <input type="range" id="invert" min="0" max="100" value="0">
        <br>
        <button id="createButton">Create</button>
      </div>
      <button id="showHideButton" value=>Hide Sliders</button>
      <button id="clearButton">Clear</button>
      <button id="undoButton">Undo</button>
      <button id="redoButton">Redo</button>
      <input type="number" id="resizeWidth" placeholder="Width">
      <input type="number" id="resizeHeight" placeholder="Height">
      <button id="resizeButton">Resize</button>
      <button id="downloadButton">Download</button>
      <input type="file" id="imageUpload">
    </div>
    <script>
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      let isDrawing = false;
      let lastX = 0;
      let lastY = 0;
      let brushSize = 10;
      let brushOpacity=255;
      let selectedColor = '#000000';
      let actions = [];
      let isRainbowMode = false;

      let pointer = 0;
      addAction();
      function draw(e) {
        if (!isDrawing) return;
        if (isRainbowMode) {
          const hue = Math.atan2(e.offsetY - lastY, e.offsetX - lastX) / (2 * Math.PI) + 0.5;
          ctx.strokeStyle = `hsl(${hue * 360}, 100%, 50%)`;
        } else {
          ctx.strokeStyle = selectedColor;
        }
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.lineWidth = brushSize;
        ctx.globalAlpha = brushOpacity/255;
        if (lastX !== 0 && lastY !== 0) {
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(e.offsetX, e.offsetY);
          ctx.stroke();
        }
        [lastX, lastY] = [e.offsetX, e.offsetY];
        addAction();
      }
      function addAction() {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const currentState = {
          data: imageData,
          width: canvas.width,
          height: canvas.height
        };
        actions = actions.slice(0, pointer + 1);
        actions.push(currentState);
      }
      canvas.addEventListener('mousedown', (e) => {
        isDrawing = true;
        [lastX, lastY] = [e.offsetX, e.offsetY];
            });
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', () => {
        isDrawing = false;
        pointer++;
      });

      function clearCanvas() {

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        canvas.width=500;
        canvas.height=500;
        pointer++;
      }
      function undo() {
        if (pointer > 0) {
          pointer--;
          const state = actions[pointer];
          canvas.width = state.width;
          canvas.height = state.height;
          ctx.putImageData(state.data, 0, 0);
        }
      }
      function redo() {
        if (pointer === actions.length - 1) return;
        pointer++;
        const state = actions[pointer];
        canvas.width = state.width;
        canvas.height = state.height;
        ctx.putImageData(state.data, 0, 0);
      }
      function resizeCanvas() {
        canvas.width = document.getElementById("resizeWidth").value;
        canvas.height = document.getElementById("resizeHeight").value;
        ctx.putImageData(actions[pointer].data, 0, 0);
        pointer++;
      }
      function downloadCanvas() {
        const link = document.createElement('a');
        link.download = 'canvas.png';
        link.href = canvas.toDataURL();
        link.click();
      }
      const rainbowButton = document.getElementById('rainbowButton');
      rainbowButton.addEventListener('click', () => {
        isRainbowMode = true;
      });
      const colorPicker = document.getElementById('colorPicker');
      const standardColors = document.getElementById('standardColors');
      const brushSizeInput = document.getElementById('brushSize');
      const brushOpacityInput = document.getElementById('brushOpacity');
      const clearButton = document.getElementById('clearButton');
      const undoButton = document.getElementById('undoButton');
      const redoButton = document.getElementById('redoButton');
      const downloadButton = document.getElementById('downloadButton');
      const resizeButton = document.getElementById('resizeButton');
      const hueSlider = document.getElementById("hue");
      const blurSlider = document.getElementById("blur");
      const contrastSlider = document.getElementById("contrast");
      const brightnessSlider = document.getElementById("brightness");
      const saturationSlider = document.getElementById("saturation");
      const createButton = document.getElementById("createButton");
      const showHideButton = document.getElementById("showHideButton");
      const sliderWrapper = document.getElementById("sliderWrapper");
      const exposureSlider = document.getElementById("exposure");
      const grayscaleSlider = document.getElementById("grayscale");
      const invertSlider=document.getElementById("invert");
      exposureSlider.addEventListener("input", applyFilters);
      grayscaleSlider.addEventListener("input",applyFilters);
      invertSlider.addEventListener("input",applyFilters);
      hueSlider.addEventListener("input", applyFilters);
      blurSlider.addEventListener("input", applyFilters);
      contrastSlider.addEventListener("input", applyFilters);
      brightnessSlider.addEventListener("input", applyFilters);
      saturationSlider.addEventListener("input", applyFilters);
      createButton.addEventListener("click", resetSliders);
      showHideButton.addEventListener("click", toggleSliders);
      let ctxnew = canvas.getContext('2d');
      
      function applyFilters() {
        const hue = document.getElementById("hue").value;
        const blur = document.getElementById("blur").value;
        const grayscale = document.getElementById("grayscale").value;
        const invert = document.getElementById("invert").value;
        const exposure = document.getElementById("exposure").value;
        const saturation = document.getElementById("saturation").value;
        const brightness = document.getElementById("brightness").value;
        const contrast = document.getElementById("contrast").value;
        const adjustedBrightness = brightness * Math.pow(2, exposure);
        const adjustedContrast = parseInt(contrast) + (exposure * 10);

        ctxnew.filter = `hue-rotate(${hue}deg) saturate(${saturation}%) brightness(${adjustedBrightness}%) contrast(${adjustedContrast}%) blur(${blur}px) grayscale(${grayscale}%) invert(${invert}%)`;
        ctxnew.drawImage(canvas, 0, 0, canvas.width, canvas.height);
      }
      function resetSliders() {
        ctx.drawImage(canvas, 0, 0, canvas.width, canvas.height);
        addAction();
        pointer++;
        hueSlider.value = 0;
        blurSlider.value = 0;
        contrastSlider.value = 100;
        exposureSlider.value = 0;
        brightnessSlider.value = 100;
        saturationSlider.value = 100;
        toggleSliders();
      }
      function toggleSliders() {
        if (sliderWrapper.style.display === "none") {
          sliderWrapper.style.display = "block";
          showHideButton.textContent = "Hide Sliders";
        } else {
          sliderWrapper.style.display = "none";
          showHideButton.textContent = "Show Sliders";
          ctxnew=canvas.getContext('2d');
        }
      }
      const imageUpload = document.getElementById('imageUpload');
      imageUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
          const image = new Image();
          image.onload = () => {
            ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
            addAction();
            pointer++;
          };
          image.src = reader.result;
        };
        reader.readAsDataURL(file);
      });
      colorPicker.addEventListener('change', () => {
        selectedColor = colorPicker.value;
      });
      standardColors.addEventListener('click', (e) => {
        if (e.target.classList.contains('color')) {
          selectedColor = e.target.style.backgroundColor;
          colorPicker.value = selectedColor;
          isRainbowMode=false;
        }
      });
      brushSizeInput.addEventListener('input', () => {
        brushSize = brushSizeInput.value;
      });
      brushOpacityInput.addEventListener('input', () => {
        brushOpacity = brushOpacityInput.value;
      });
      clearButton.addEventListener('click', clearCanvas);
      undoButton.addEventListener('click', undo);
      redoButton.addEventListener('click', redo);
      downloadButton.addEventListener('click', downloadCanvas);
      const customColorInput = document.getElementById('customColor');

      customColorInput.addEventListener('input', () => {
        const customColor = customColorInput.value;
        if (isHexColor(customColor)) {
          selectedColor = customColor;
        }
      });
      const customColorPicker = document.getElementById('customColorPicker');
      customColorPicker.addEventListener('click', (e) => {
        const customColor = e.target.style.backgroundColor;
        if (isHexColor(customColor)) {
          selectedColor = customColor;
          customColorInput.value = customColor;
        }
      });
      function isHexColor(color) {
        return /^#[0-9A-F]{6}$/i.test(color);
      }
      resizeButton.addEventListener('click', resizeCanvas);
      sliderWrapper.style.display = "none";
      showHideButton.textContent = "Show Sliders";
    </script>
  </body>
</html>