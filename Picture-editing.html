<!DOCTYPE html>
<html>
    <head>
        <title>Drawing App</title>
        <style>
          /*general*/
            .text-background{
              color:rgb(255, 255, 255);
              font-size:3vw;
              text-align: center;
              font-family: UWU2;
              font-weight: bolds;
              background-color: rgb(255, 211, 218);
              position: absolute;
              width: 100%;
              height: 3vw;
              vertical-align:text-bottom;
              padding-bottom: 0.5vw;
            }
            body {
              font-family: Arial, sans-serif;
              margin: 0vw;
              color: palevioletred;
            }
            @font-face {
                font-family: UWU2;
                src: url(HashedBrowns-WyJgn.ttf);
            }
            .resp_img{
              width: 3.5vw;
            }
          /*switch*/
            .switch {
              position: relative;
              display: inline-block;
              width:5vw;
              height: 2.5vw;
              border-radius: 34px;
              margin: 0.4vw;
              right:3vw;
            }
            .switch input { 
              opacity: 0;
              width: 0;
              height: 0;
            }
            .slider {
              position: absolute;
              cursor: pointer;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background-color: #FDF1F4;
              -webkit-transition: .4s;
              transition: .4s;
              border-radius: 2vw;
            }
            .slider:before {
              position: absolute;
              content: "";
              height: 2vw;
              width: 2vw;
              left: 0.25vw;
              bottom:0.25vw;
              background-color: white;
              -webkit-transition: .4s;
              transition: .4s;
              border-radius: 50%;
            }
            input:checked + .slider {
              background-color: pink;
            }
            input:focus + .slider {
              box-shadow: 0 0 1px pink;
            }
            input:checked + .slider:before {
              -webkit-transform: translateX(2.5vw);
              -ms-transform: translateX(2.5vw);
              transform: translateX(2.5vw);
            }
          /*menue*/
            .menu__box {
              position: fixed;
              top:3.4vw;
              left: 0;
              width: 16vw;
              height: 34vw;
              list-style: none;
              padding:0vw;
              background: #fedee3;
              box-shadow: white;
              margin :0;
              border-radius: 0 0 2vw 0;
            }
            .menu__item {
              display: block;
              padding: 2vw 2vw;
              top:0vw;
              color: white;
              font-size: 20px;
              font-weight: 1.5px;
              position: relative;
              font-size: 1.5vw;
              border:none;
              background-color:#fdf1f400;
              cursor: pointer;
            }
            .menu_item_selected{
              color:rgb(255, 73, 170);
              font-weight: bold;
              text-decoration: underline;
            }
          /*options*/
            .opt__box {
              position: fixed;
              top:3.4vw;
              right: 0;
              width: 22vw;
              height: 40vw;
              list-style: none;
              padding:0vw;
              background: #fedee3;
              box-shadow: white;
              margin :0;
              border-radius: 0 0 0 2vw;
            }
          /*info*/
            .info{
              background-color: rgb(255, 194, 218);
              bottom:0;
              position: fixed;
              width: 100%;
              text-align: center;
            }
          /*canvas*/
            #canvas {
              border: 1px solid black;
              margin: 0 auto;
              display: block;
              top:5vw;

              position: absolute;
            }
            #tempcanvas{
              border: 1px solid black;
              margin: 0 auto;
              display: block;
              top:5vw;
              position: absolute;
            }
            #cursercanvas{
              border: 1px solid black;
              margin: 0 auto;
              display: block;
              top:5vw;
              position: absolute;
            }
            #textinput{
              width: 20vw;
              height: 2vw;
              padding: 2px 2px;
              margin:1vw;
              box-sizing: border-box;
              border: 2px solid #fccce2;
              border-radius: 4px;
              background-color: #ffefef;
              resize: none;
            }
            input[type=text], select {

              border-color: #1900ff;

            }

            .left30{
              left:30%;
            }
            .left-100{
              left:-100%;
            }
            .undoButton{
              margin:0.3vw;
              width: 4vw;
              height: 2vw;
              background-color: #ffbccd;
              border: none;
              border-radius: 15%;
              font-size: 1vw;
              color:#fff;
              cursor: pointer;
            }
            .redoButton{
              margin:0.3vw;
              width: 4vw;
              height: 2vw;
              background-color: #ffbccd;
              border: none;
              border-radius: 15%;
              font-size: 1vw;
              color:#fff;
              cursor: pointer;
            }
            .clearButton{
              margin:0.3vw;
              width: 4vw;
              height: 2vw;
              background-color: #ffbccd;
              border: none;
              border-radius: 15%;
              font-size: 1vw;
              color:#fff;
              cursor: pointer;
            }
            .createButton{
              margin:0.3vw;
              width: 4vw;
              height: 2vw;
              background-color: #ffbccd;
              border: none;
              border-radius: 15%;
              font-size: 1vw;
              color:#fff;
              cursor: pointer;
            }
            .cancelButton{
              margin:0.3vw;
              width: 4vw;
              height: 2vw;
              background-color: #ffbccd;
              border: none;
              border-radius: 15%;
              font-size: 1vw;
              color:#fff;
              cursor: pointer;
            }
            .undoButton:disabled{
              background-color: #ea9fb4;
            }
            .redoButton:disabled{
              background-color: #ea9fb4;
            }
            .clearButton:disabled{
              background-color: #ea9fb4;
            }
            .menuButtons{
              display: flex;
              justify-content: center;
            }
            .color {
              width: 2.5vw;
              height: 2.5vw;
              cursor: pointer;
              border: 1px solid rgb(255, 255, 255);
              margin:0.3vw;
              border-radius: 0.3vw;
            }
            .color:hover {
              opacity: 0.7;
            }
            #standardColors{
              display: flex;
              flex-wrap: wrap;
              justify-content: center;
            }
            #standardColorsText{
              display: flex;
              flex-wrap: wrap;
              justify-content: center;
            }
            .opt_slider {
              -webkit-appearance: none;
              width: 80%;
              height: 1vw;
              border-radius: 5px;  
              background: #fffafa;
              outline: none;
              opacity: 0.7;
              margin:1vw;
            }
            .opt_slider::-webkit-slider-thumb {
              -webkit-appearance: none;
              appearance: none;
              width: 1.3vw;
              height: 1.3vw;
              border-radius: 50%; 
              background: #ff83b5;
              cursor: pointer;
            }
            label{
              font-size: 1.3vw;
              margin:1vw
            }
            .box{
              width: 2px;
              height: 20px;

              background-color: #000000;
              animation-name: example;
              animation-duration: 1s;
              animation-iteration-count: infinite;
              }
              @keyframes example {
                0%   {background-color:rgb(0, 0, 0);}
                100% {background-color:rgba(0, 0, 0, 0);}
              }
              #font-selector {
                  margin: 20px;
              }
              #text {
                margin: 20px;
                font-size: 24px;
              }
              .font-option {
                display: inline-block;
                font-size: 16px;
                padding: 4px;
              }

        </style>
    </head>
    <body>
        <div>
            <div class="text-background"id=myDIV2>Editing</div>
            <a href="index.html"><img src="pics/logo.png" class="resp_img" style="position: relative;left:42vw" ></a>
            <label class="switch" style="float: right;">
                <input type="checkbox" id="toggle-mode"onclick="changecolor()">
                <span class="slider"></span>
            </label>
        </div><!--navbar*/ -->
        <div>
            <ul class="menu__box">
                <li><input type="button" class="menu__item menu_item_selected"id="menu_draw" onclick="selectMenuDraw()" value="Draw"></li>
                <li><input type="button" class="menu__item" id="menu_filters" onclick="selectMenuFilters()" value="Filters"></li>
                <li><input type="button" class="menu__item" id="menu_forms" onclick="selectMenuFroms()" value="Forms"></li>
                <li><input type="button" class="menu__item" id="menu_text" onclick="selectMenuText()" value="Text"></li>
                <li><input type="button" class="menu__item" id="menu_load" onclick="selectMenuLoad()" value="Image"></li>
                <li class="menuButtons"><button class="undoButton"id="undoButton">Undo</button><button class="redoButton"id="redoButton">Redo</button><button class="clearButton"id="clearButton">Clear</button></li>
          </ul>
        </div><!--menubox -->
        <div>
            <canvas id="canvas" width="500" height="500"></canvas>
            <canvas id="tempcanvas" width="500" height="500"></canvas>
            <canvas id="cursercanvas" width="500"height="500"></canvas>

            <div class="box" hidden="true" id="textcursor"></div><!--cursor-->
        </div><!--canvas -->
        <div>
            <ul class="opt__box">
                <div id="opt_draw">
                  <br><br>
                  <div id="standardColors">
                    <input  class="color" type="color" id="colorPicker" value="#000000">
                    <div class="color rbw"id="rainbowButton" style="width: 2.5vw; height: 2.5vw; background: linear-gradient( to bottom right,rgb(255, 122, 122),rgb(255, 255, 26),rgb(141, 255, 141),rgb(112, 112, 255),rgb(215, 160, 255),violet); cursor: pointer;"></div>
                    <div class="color" style="background-color: #000000;"></div>
                    <div class="color" style="background-color: #FF0000;"></div>
                    <div class="color" style="background-color: #00FF00;"></div>
                    <div class="color" style="background-color: #0000FF;"></div>
                    <div class="color" style="background-color: #FFFF00;"></div>
                    <div class="color" style="background-color: #FF00FF;"></div>
                    <div class="color" style="background-color: #00FFFF;"></div>
                    <div class="color" style="background-color: #FFFFFF;"></div>
                    <div class="color" style="background-color: #FFA500;"></div>
                    <div class="color" style="background-color: #8c00ff;"></div>
                    <img src="pics/eraser.png" class="color ers" id="eraser" width="2.5vw"height="2.5vw">
                    <img src="pics/bucket.png" class="color fill" id="fill" width="2.5vw"height="2.5vw">
                  </div>
                  <br>
                  <label for="brushSize">Brush Size:</label>
                  <input class="opt_slider" type="range" id="brushSize" min="1" max="150" value="10">
                  <label for="brushOpacity">Opacity:</label>
                  <input class="opt_slider" type="range" id="brushOpacity" min="1" max = "255" value="255">
                </div>
                <div id="opt_filters"  hidden="true">
                  <label for="hue">Hue:</label>
                  <input class="opt_slider"type="range" id="hue" min="-180" max="180" value="0">
                  <label for="blur">Blur:</label>
                  <input class="opt_slider"type="range" id="blur" min="0" max="25" step="0.1" value="0">
                  <label for="contrast">Contrast:</label>
                  <input class="opt_slider"type="range" id="contrast" min="0" max="200"  value="100">
                  <label for="exposure">Exposure:</label>
                  <input class="opt_slider"type="range" id="exposure" min="-5" max="5" step="0.1" value="0">
                  <label for="brightness">Brightness:</label>
                  <input class="opt_slider"type="range" id="brightness" min="0" max="200" value="100">
                  <label for="saturation">Saturation:</label>
                  <input class="opt_slider"type="range" id="saturation" min="0" max="200" value="100">
                  <label for="grayscale">Gray-scale:</label>
                  <input class="opt_slider"type="range" id="grayscale" min="0" max="100" value="0">
                  <label for="invert">Invert</label>
                  <input class="opt_slider"type="range" id="invert" min="0" max="100" value="0">
                  <div class="menuButtons"><button class="cancelButton"id="cancelButton_filters">Cancel</button><button id="createButton_filters"class="createButton">Create</button></div>
                </div>


                
                <div id="opt_forms"  hidden="true">
                  <div id="forms-selector">
                    <label >Form:</label>
                    <select id="forms-select" size="1">
                      <option value="forms_line" class="forms-option">Line</option>
                      <option value="forms_tri" class="forms-option">Triangle</option>
                      <option value="forms_rect" class="forms-option">Rectangle</option>
                      <option value="forms_circle" class="forms-option">Circle</option>
                      <option value="forms_elypse" class="forms-option">Elipse</option>
                      <option value="forms_anygon" class="forms-option">Any-Gon</option>
                      <option value="forms_polygon" class="forms-option">Polygon</option>
                      <option value="forms_heart" class="forms-option">Heart</option>
                    </select>
                  </div>
                


                  <div id="forms_line"hidden=true>
                    <p>line</p>
                  </div>
                  <div id="forms_tri"hidden=true>
                    <p>tri</p>
                  </div>
                  <div id="forms_rect"hidden=true>
                      <p>rect</p>
                  </div>
                  <div id="forms_circle"hidden=true>
                    <p>circle</p>
                  </div>
                  <div id="forms_elypse"hidden=true>
                    <p>elipse</p>
                  </div>
                  <div id="forms_anygon"hidden=true>
                    <p>anygon</p>
                  </div>
                  <div id="forms_polygon"hidden=true>
                    <p>polygon</p>
                  </div>
                  <div id="forms_heart"hidden=true>
                    <p>heart</p>
                  </div>








                  <div class="menuButtons"><button class="cancelButton"id="cancelButton_forms">Cancel</button><button id="createButton_forms"class="createButton">Create</button></div>
                </div>



                <div id="opt_text"  hidden="true">
                  <div id="standardColorsText">
                    <input  class="color pik" type="color" id="colorPickerText" value="#000000">
                    <div class="color" style="background-color: #000000;"></div>
                    <div class="color" style="background-color: #FF0000;"></div>
                    <div class="color" style="background-color: #00FF00;"></div>
                    <div class="color" style="background-color: #0000FF;"></div>
                    <div class="color" style="background-color: #FFFF00;"></div>
                    <div class="color" style="background-color: #FF00FF;"></div>
                    <div class="color" style="background-color: #00FFFF;"></div>
                    <div class="color" style="background-color: #FFFFFF;"></div>
                    <div class="color" style="background-color: #FFA500;"></div>
                    <div class="color" style="background-color: #8c00ff;"></div>
                  </div>
                  <label for="Textsize">Size:</label>
                  <input class="opt_slider"type="range" id="Textsize" min="10" max="200" value="20">
                  <div id="font-selector">
                    <label >Font:</label>
                    <select id="font-select" size="1">
                      <option style="font-family:Arial;" value="Arial" class="font-option">Arial</option>
                      <option style="font-family:Verdana;" value="Verdana" class="font-option">Verdana</option>
                      <option style="font-family:Tahoma;" value="Tahoma" class="font-option">Tahoma</option>
                      <option style="font-family:Trebuchet MS;" value="Trebuchet MS" class="font-option">Trebuchet MS</option>
                      <option style="font-family:Impact;" value="Impact" class="font-option">Impact</option>
                      <option style="font-family:Comic Sans MS;" value="Comic Sans MS" class="font-option">Comic Sans MS</option>
                      <option style="font-family:Georgia;" value="Georgia" class="font-option">Georgia</option>
                      <option style="font-family:Times New Roman;" value="Times New Roman" class="font-option">Times New Roman</option>
                      <option style="font-family:Courier New;" value="Courier New" class="font-option">Courier New</option>
                      <option style="font-family:Lucida Console;" value="Lucida Console" class="font-option">Lucida Console</option>
                      <option style="font-family:Tahoma;" value="Tahoma" class="font-option">Tahoma</option>
                      <option style="font-family:Arial Black;" value="Arial Black" class="font-option">Arial Black</option>
                    </select>
                  </div>



                  <label for="textinput">Text:</label><br>
                  <textarea id="textinput"></textarea>
                  <div class="menuButtons"><button class="cancelButton"id="cancelButton_text">Cancel</button><button id="createButton_text"class="createButton">Create</button></div>
                </div>
                <div id="opt_load"  hidden="true">
                  <button id="downloadButton">Download</button>
                </div>
            </ul>
        </div><!--option box -->
        <div class="info">
          <!-- @azra hier info dazutuhen bei jedem-->
            <div id="info_draw">
                <b>*Hier kommen die beschreibungen der einzelnen optinen hin /draw*</b>
            </div>
            <div id="info_filters" hidden="true">
                <b>*Hier kommen die beschreibungen der einzelnen optinen hin /filters*</b>
            </div>
            <div id="info_forms" hidden="true">
                <b>*Hier kommen die beschreibungen der einzelnen optinen hin /forms*</b>
            </div>
            <div id="info_text" hidden="true">
                <b>*Hier kommen die beschreibungen der einzelnen optinen hin /text*</b>
            </div>
            <div id="info_load" hidden="true">
                <b>*Hier kommen die beschreibungen der einzelnen optinen hin /load*</b>
            </div>
        </div><!--info box -->

        <!--@lela hier footer einfügen-->

        <script>
/*------------------------------------------script----------------------------------------*/
          /*static management*/
            function unselectAllMenu(){
                var element = document.getElementById("menu_draw");
                element.classList.remove("menu_item_selected");
                element = document.getElementById("menu_filters");
                element.classList.remove("menu_item_selected");
                element = document.getElementById("menu_forms");
                element.classList.remove("menu_item_selected");
                element = document.getElementById("menu_text");
                element.classList.remove("menu_item_selected");
                element = document.getElementById("menu_load");
                element.classList.remove("menu_item_selected");
                document.getElementById("undoButton").disabled = false;
                document.getElementById("redoButton").disabled = false;
                document.getElementById("clearButton").disabled = false;
                modeDraw=false;
                modeFilters = false;
                modeForms = false;
                modeText = false;
                modeLoad = false;
                isDrawing=false;
                element=document.getElementById("tempcanvas");
                element.classList.add("left-100");
                element.classList.remove("left30");
                element=document.getElementById("cursercanvas");
                element.classList.add("left-100");
                element.classList.remove("left30");
                element=document.getElementById("canvas");
                element.classList.add("left30");
                element.classList.remove("left-100");
                tempCtx.putImageData(actions[0].data, 0, 0);
                element=document.getElementById("textcursor");
                element.hidden=true;
                resetFilters();
            }
            function unloadAllOptions(){
                var element = document.getElementById("opt_draw");
                element.hidden=true;
                element = document.getElementById("opt_filters");
                element.hidden=true;
                element = document.getElementById("opt_forms");
                element.hidden=true;
                element = document.getElementById("opt_text");
                element.hidden=true;
                element = document.getElementById("opt_load");
                element.hidden=true;
            }
            function unloadAllInfo(){
                var element = document.getElementById("info_draw");
                element.hidden=true;
                element = document.getElementById("info_filters");
                element.hidden=true;
                element = document.getElementById("info_forms");
                element.hidden=true;
                element = document.getElementById("info_text");
                element.hidden=true;
                element = document.getElementById("info_load");
                element.hidden=true;
            }
            function loadTempCanVas(){
              document.getElementById("undoButton").disabled = true;
              document.getElementById("redoButton").disabled = true;
              document.getElementById("clearButton").disabled = true;
              element=document.getElementById("canvas");
              element.classList.add("left-100");
              element.classList.remove("left30");
              element=document.getElementById("tempcanvas");
              element.classList.add("left30");
              element.classList.remove("left-100");
              tempCtx.drawImage(canvas, 0, 0);
            }
            function selectMenuDraw(){
                unselectAllMenu();
                unloadAllOptions();
                unloadAllInfo();
                var element = document.getElementById("menu_draw");
                element.classList.add("menu_item_selected");
                element = document.getElementById("opt_draw");
                element.hidden=false;
                element = document.getElementById("info_draw");
                element.hidden=false;
                modeDraw=true;
            }
            function selectMenuFilters(){
                unselectAllMenu();
                unloadAllOptions();
                unloadAllInfo();
                var element = document.getElementById("menu_filters");
                element.classList.add("menu_item_selected");
                element = document.getElementById("opt_filters");
                element.hidden=false;
                element = document.getElementById("info_filters");
                element.hidden=false;
                document.getElementById("undoButton").disabled = true;
                document.getElementById("redoButton").disabled = true;
                document.getElementById("clearButton").disabled = true;
                modeFilters=true;
                loadTempCanVas();
            }
            function selectMenuFroms(){
                unselectAllMenu();
                unloadAllOptions();
                unloadAllInfo();
                var element = document.getElementById("menu_forms");
                element.classList.add("menu_item_selected");
                element = document.getElementById("opt_forms");
                element.hidden=false;
                element = document.getElementById("info_forms");
                element.hidden=false;
                modeForms = true;
                loadTempCanVas();
                element = document.getElementById("forms_line");
                element.hidden=false;
            }
            function selectMenuText(){
                unselectAllMenu();
                unloadAllOptions();
                unloadAllInfo();
                var element = document.getElementById("menu_text");
                element.classList.add("menu_item_selected");
                element = document.getElementById("opt_text");
                element.hidden=false;
                element = document.getElementById("info_text");
                element.hidden=false;
                modeText=true;
                loadTempCanVas();
                element=document.getElementById("cursercanvas");
                element.classList.add("left30");
                element.classList.remove("left-100");
                drawTextCurser();
                element=document.getElementById("textcursor");
                element.hidden=false;
            }
            function selectMenuLoad(){
                unselectAllMenu();
                unloadAllOptions();
                unloadAllInfo();
                var element = document.getElementById("menu_load");
                element.classList.add("menu_item_selected");
                element = document.getElementById("opt_load");
                element.hidden=false;
                element = document.getElementById("info_load");
                element.hidden=false;
                modeLoad=true;
            }
  /*-----------------here all functinsfor canvas begin------------------*/
          /*initialisation*/
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const tempCanvas= document.getElementById('tempcanvas');
            const tempCtx= tempcanvas.getContext('2d');
            const curserCanvas = document.getElementById('cursercanvas');
            const curserCtx=curserCanvas.getContext('2d');

            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let curserX=0;
            let curserY=0;
            let brushSize = 10;
            let brushOpacity=255;
            let selectedColor = '#000000';
            let actions = [];
            let pointer = 0;
            let isRainbowMode = false;
            let isEraseMode=false;
            let isFillMode=false;
            let modeDraw=true;
            let modeFilters = false;
            let modeForms = false;
            let modeText = false;
            let modeLoad = false;
            let image;
            let cWidth=500;
            let cHeight=500;
            let mouse_Down=false;
            let selectedFont= "Arial";
            let selectedform="forms_line";

            let x = 50;
		        let y = 50;
		        let isResizing = false;
            let isrectangular = false;
            let clicks = [];
            let corners=8;
            let forms_c1='#000000';
            let forms_c2='';



          /*consts*/

            const fontSelect = document.getElementById("font-select");
            const formSelect = document.getElementById("forms-select")
            const clearButton = document.getElementById('clearButton');
            const undoButton = document.getElementById('undoButton');
            const redoButton = document.getElementById('redoButton');
            const colorPicker = document.getElementById('colorPicker');
            const colorPickerText = document.getElementById('colorPickerText');
            const standardColors = document.getElementById('standardColors');
            const standardColorsText = document.getElementById('standardColorsText');
            const brushSizeInput = document.getElementById('brushSize');
            const brushOpacityInput = document.getElementById('brushOpacity');
            const downloadButton = document.getElementById('downloadButton');
            const cancelButton_filter = document.getElementById('cancelButton_filters');
            const createButton_filter = document.getElementById('createButton_filters');
            const cancelButton_forms = document.getElementById('cancelButton_forms');
            const createButton_forms = document.getElementById('createButton_forms');
            const cancelButton_text = document.getElementById('cancelButton_text');
            const createButton_text = document.getElementById('createButton_text');
            const TextSizeSlider = document.getElementById("Textsize");
            const TextInput = document.getElementById("textinput");
            const hueSlider = document.getElementById("hue");
            const blurSlider = document.getElementById("blur");
            const contrastSlider = document.getElementById("contrast");
            const brightnessSlider = document.getElementById("brightness");
            const saturationSlider = document.getElementById("saturation");
            const showHideButton = document.getElementById("showHideButton");
            const sliderWrapper = document.getElementById("sliderWrapper");
            const exposureSlider = document.getElementById("exposure");
            const grayscaleSlider = document.getElementById("grayscale");
            const invertSlider=document.getElementById("invert");
            const fill =document.getElementById("fill");
            const form_Line = document.getElementById("forms_line");
            const form_Tri = document.getElementById("forms_tri");
            const form_Rect = document.getElementById("forms_rect");
            const form_Circle = document.getElementById("forms_circle");
            const form_Elypse = document.getElementById("forms_elypse");
            const form_Anygon = document.getElementById("forms_anygon");
            const form_Polygon = document.getElementById("forms_polygon");
            const form_Heart = document.getElementById("forms_heart");


          /*startfunctions*/
            addAction();
            selectMenuDraw();

          /*eventlisterns*/
            clearButton.addEventListener('click', clearCanvas);
            undoButton.addEventListener('click', undo);
            redoButton.addEventListener('click', redo);
            downloadButton.addEventListener('click', downloadCanvas);
            canvas.addEventListener('mousemove', draw);
            cancelButton_filter.addEventListener('click',cancel);
            createButton_filter.addEventListener('click',create);
            cancelButton_forms.addEventListener('click',cancel);
            createButton_forms.addEventListener('click',create);
            cancelButton_text.addEventListener('click',cancel);
            createButton_text.addEventListener('click',create);
            TextSizeSlider.addEventListener("input",drawTextCurser);
            exposureSlider.addEventListener("input", applyFilters);
            grayscaleSlider.addEventListener("input",applyFilters);
            invertSlider.addEventListener("input",applyFilters);
            hueSlider.addEventListener("input", applyFilters);
            blurSlider.addEventListener("input", applyFilters);
            contrastSlider.addEventListener("input", applyFilters);
            brightnessSlider.addEventListener("input", applyFilters);
            TextInput.addEventListener("input",drawTextCurser);
            saturationSlider.addEventListener("input", applyFilters);
            canvas.addEventListener('mousedown', (e) => {
              if(modeDraw){
                isDrawing = true;
              [lastX, lastY] = [e.offsetX, e.offsetY];
                  }
              if(isFillMode){
                flood_fill(lastX,lastY,color_to_rgba(selectedColor));
              }
              });
            canvas.addEventListener('mouseup', () => {
              if(modeDraw){
                isDrawing = false;
              addAction();
              }
            });
            curserCanvas.addEventListener('mousedown',(e)=>{
              if(modeText){
                [lastX, lastY] = [e.offsetX, e.offsetY];
                [curserX,curserY]=[e.x,e.y];
                drawTextCurser(e);
                mouse_Down=true;
              }
            });
            curserCanvas.addEventListener('mouseup',(e)=>{
              if(modeText){

                mouse_Down=false;
              }
            });
            curserCanvas.addEventListener('mouseout',(e)=>{
              if(modeText){
                mouse_Down=false;
              }
            });
            curserCanvas.addEventListener('mousemove',(e)=>{
              
              if(mouse_Down){
                if(modeText){
                  [lastX, lastY] = [e.offsetX, e.offsetY];
                  [curserX,curserY]=[e.x,e.y];
                  drawTextCurser(e);
                }
              }

            });
            colorPicker.addEventListener('change', () => {
              selectedColor = colorPicker.value;
            });
            standardColors.addEventListener('click', (e) => {
              if (e.target.classList.contains('color')) {
                isRainbowMode=false;
                  isEraseMode=false;
                  isFillMode=false;
                if (e.target.classList.contains('rbw')){
                  isRainbowMode=true
                }
                else if (e.target.classList.contains('ers')){
                  isEraseMode=true;

                }
                else if (e.target.classList.contains('fill')){
                  isFillMode=true;
                }
                else{

                  
                  selectedColor = e.target.style.backgroundColor;
                  colorPicker.value = selectedColor;
                }

              }
            });
            colorPickerText.addEventListener('change', () => {
              selectedColor = colorPickerText.value;

              drawTextCurser(null);
            });
            standardColorsText.addEventListener('click', (e) => {
              if (e.target.classList.contains('color')) {
                if (e.target.classList.contains('pik')) {
                  selectedColor = colorPickerText.value;
                }
                else{
                  selectedColor = e.target.style.backgroundColor;
                  colorPicker.value = selectedColor;
                }
                drawTextCurser(null);
              }
            });
            standardColorsText.addEventListener('click', (e) => {
              if (e.target.classList.contains('color')) {

                  selectedColor = e.target.style.backgroundColor;

              }
            });
            brushSizeInput.addEventListener('input', () => {
              brushSize = brushSizeInput.value;
            });
            brushOpacityInput.addEventListener('input', () => {

              brushOpacity = brushOpacityInput.value;
            });
            fontSelect.addEventListener("change", function() {
			        selectedFont = fontSelect.value;
              drawTextCurser(null);
		        });
            formSelect.addEventListener("change",function(){
              selectedform=formSelect.value;
              const forms =["forms_line","forms_tri","forms_rect","forms_circle","forms_elypse","forms_anygon","forms_polygon","forms_heart","forms_star"];
              for(var i=0; i < forms.length; i++) { 
                var element = document.getElementById(forms[i]);
                if(selectedform==forms[i]) element.hidden=false;
                else element.hidden=true;
              }
            });
            tempCanvas.addEventListener("mousedown", function(event) {
              if(modeForms){
                x= event.clientX - tempCanvas.offsetLeft;
                y= event.clientY - tempCanvas.offsetTop;
                isResizing = true;
                if(selectedform=="forms_anygon"){
                  clicks.push({
                  x: event.offsetX,
                  y: event.offsetY
                  });
                  tempCtx.clearRect(0, 0, canvas.width, canvas.height);
                  tempCtx.drawImage(canvas, 0, 0);
                  tempCtx.fillStyle = 'rgba(100,100,100,0.5)';
                  tempCtx.strokeStyle = "#000000";
                  tempCtx.lineWidth = 1;
                  tempCtx.beginPath();
                  tempCtx.moveTo(clicks[0].x, clicks[0].y);
                  for(var i=1; i < clicks.length; i++) { 
                    tempCtx.lineTo(clicks[i].x,clicks[i].y);
                  }
                  tempCtx.closePath();
                  tempCtx.fill();
                  tempCtx.stroke();
                }
              }
            });
            tempCanvas.addEventListener("mouseup", function(event) {
              if(modeForms){
                isResizing = false;
              }
            });
            tempCanvas.addEventListener("mousemove", function(event) {
              if(modeForms){
                if(selectedform=="forms_line"){
                  var mouseX = event.clientX - tempCanvas.offsetLeft;
                  var mouseY = event.clientY - tempCanvas.offsetTop;
                  if (isResizing) {
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(canvas, 0, 0);
                    tempCtx.fillStyle = "red";
                    tempCtx.beginPath();
                    tempCtx.moveTo(x, y);
                    tempCtx.lineTo(mouseX, mouseY);
                    tempCtx.stroke();
                  }
                }
                else if(selectedform=="forms_tri"){
                  var mouseX = event.clientX - tempCanvas.offsetLeft;
                  var mouseY = event.clientY - tempCanvas.offsetTop;
                  if (isResizing) {
                    width = mouseX - x;
                    height = mouseY - y;
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.fillStyle = "red";
                    tempCtx.fillStyle = 'rgba(100,100,100,0.5)';
                    tempCtx.drawImage(canvas, 0, 0);
                    tempCtx.beginPath();
                    if(isrectangular){
                      tempCtx.moveTo(x, y);
                      tempCtx.lineTo(x, mouseY);
                      tempCtx.lineTo(mouseX, mouseY);
                    }
                    else{
                      tempCtx.moveTo((x+mouseX)/2, y);
                      tempCtx.lineTo(x, mouseY);
                      tempCtx.lineTo(mouseX, mouseY);
                    }
                    tempCtx.closePath();
                    tempCtx.stroke();
                  }
                }
                else if(selectedform=="forms_rect"){
                  var mouseX = event.clientX - tempCanvas.offsetLeft;
                  var mouseY = event.clientY - tempCanvas.offsetTop;
                  if (isResizing) {
                    width = mouseX - x;
                    height = mouseY - y;
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(canvas, 0, 0);
                    tempCtx.beginPath();
                    tempCtx.fillStyle = "red";
                    tempCtx.roundRect(x, y, width, height,0);//(0°rounded corners)
                    tempCtx.stroke();
                  }
                }
                else if(selectedform=="forms_circle"){
                  var mouseX = event.clientX - tempCanvas.offsetLeft;
                  var mouseY = event.clientY - tempCanvas.offsetTop;
                  if (isResizing) {
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(canvas, 0, 0);
                    tempCtx.fillStyle = 'rgba(100,100,100,0.5)';
                    tempCtx.beginPath();
                    //mathe abvoten?
                    var a = mouseX-x;
                    var b = mouseY-y;
                    if(a<0)a=a*(-1);
                    if(b<0)b=b*(-1);
                    var r= Math.max(a,b)/2;
                    tempCtx.arc((x+mouseX)/2, (y+mouseY)/2, r, 0, 360,false);//(clockwise)
                    tempCtx.stroke();
                  }
                }
                else if(selectedform=="forms_elypse"){
                  var mouseX = event.clientX - tempCanvas.offsetLeft;
                  var mouseY = event.clientY - tempCanvas.offsetTop;
                  if (isResizing) {
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(canvas, 0, 0);
                    tempCtx.fillStyle = 'rgba(100,100,100,0.5)';
                    tempCtx.beginPath();
                    //mathe abschaffen?
                    var a = mouseX-x;
                    var b = mouseY-y;
                    if(a<0)a=a*(-1);
                    if(b<0)b=b*(-1);
                    tempCtx.ellipse((x+mouseX)/2, (y+mouseY)/2, a/2, b/2, 0, 0, 360);
                    tempCtx.stroke();
                  }
                }
                else if(selectedform=="forms_polygon"){
                  var mouseX = event.clientX - tempCanvas.offsetLeft;
                  var mouseY = event.clientY - tempCanvas.offsetTop;
                  if (isResizing) {
                    changecorners(event);
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(canvas, 0, 0);
                    tempCtx.strokeStyle="red";
                    tempCtx.fillStyle = 'rgba(100,100,100,0.5)';
                    var a = mouseX-x;
                    var b = mouseY-y;
                    if(a<0)a=a*(-1);
                    if(b<0)b=b*(-1);
                    var r= Math.max(a,b)/2;
                    tempCtx.beginPath();
                    tempCtx.moveTo(clicks[0]._x,clicks[0]._y);//(clockwise)
                    for(var i=1; i < clicks.length; i++) { 
                      tempCtx.lineTo(clicks[i]._x,clicks[i]._y);
                    }
                    tempCtx.closePath();
                    tempCtx.stroke();
                  }
                }
                else if(selectedform=="forms_heart"){
                  var mouseX = event.clientX - tempCanvas.offsetLeft;
                  var mouseY = event.clientY - tempCanvas.offsetTop;
                  if (isResizing) {
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(canvas, 0, 0);
                    tempCtx.strokeStyle="red";
                    tempCtx.fillStyle = 'rgba(100,100,100,0.5)';
                    var a = mouseX-x;
                    var b = mouseY-y;
                    var k =x;
                    var d=b;//height
                    var v = a;//width
                    tempCtx.beginPath();
                    tempCtx.moveTo(k, k + d / 4);
                    tempCtx.quadraticCurveTo(k        , k        , k + v / 4  , k);
                    tempCtx.quadraticCurveTo(k + v / 2, k        , k + v / 2  , k + d / 4);
                    tempCtx.quadraticCurveTo(k + v / 2, k        , k + v * 3/4, k);
                    tempCtx.quadraticCurveTo(k + v    , k        , k + v      , k + d / 4);
                    tempCtx.quadraticCurveTo(k + v    , k + d / 2, k + v * 3/4, k + d * 3/4);
                    tempCtx.lineTo(			 k + v / 2, k + d);
                    tempCtx.lineTo(			 k + v / 4, k + d * 3/4);
                    tempCtx.quadraticCurveTo(k        , k + d / 2, k          , k + d / 4);
                    tempCtx.closePath();
                    tempCtx.stroke();
                  }
                }
              }
            });

          /*functions*/
          function changecorners(event){
            var mouseX = event.clientX - tempCanvas.offsetLeft;
            var mouseY = event.clientY - tempCanvas.offsetTop;
            var a = mouseX-x;
            var b = mouseY-y;
            if(a<0)a=a*(-1);
            if(b<0)b=b*(-1);
            var r= Math.max(a,b)/2;
            var alpha = 360/corners;
            clicks = null;
            clicks = [];
            for(var i=0; i < corners+1; i++) { 
              clicks.push({
                _x: (mouseX+x)/2  +  Math.cos(i*alpha * Math.PI / 180)*r,
                _y: (mouseY+y)/2  +  Math.sin(i*alpha * Math.PI / 180)*r
              });
            }
          }

            function addAction() {
              if(pointer<actions.length){
                for (let i = pointer-1; i < actions.length; i++) {
                  actions.pop();
                }
              }
              const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
              const currentState = {
                data: imageData,
                width: canvas.width,
                height: canvas.height
              };
              actions.push(currentState);
              pointer++;
            }

            function clearCanvas() {
              ctx.putImageData(actions[0].data, 0, 0);
              addAction();
            }

            function drawTextCurser(e){
             curserCtx.putImageData(actions[0].data, 0, 0);
              var d = document.getElementById("textcursor");
              d.style.position = "absolute";
              let cordstrg =  curserX+"px";
              d.style.left = cordstrg;
              cordstrg = curserY-TextSizeSlider.value+"px";
              d.style.top = cordstrg;
              cordstrg= TextSizeSlider.value+"px";
              d.style.height= cordstrg;
              let strg = TextSizeSlider.value +"px "+selectedFont;
              curserCtx.font= strg;
              curserCtx.fillStyle =selectedColor;
              curserCtx.fillText(TextInput.value, lastX, lastY);
            }

            function draw(e) {
                if (!isDrawing) return;
                if(isEraseMode){
                  ctx.save(); 
                  ctx.beginPath();
                  ctx.arc(e.offsetX, e.offsetY, brushSize/2, 0, 2*Math.PI); 
                  ctx.clip();
                  ctx.clearRect(0, 0, canvas.width, canvas.height); 
                  ctx.restore(); 
                }
                else{
                  if (isRainbowMode) {
                    const hue = Math.atan2(e.offsetY - lastY, e.offsetX - lastX) / (2 * Math.PI) + 0.5;
                    ctx.strokeStyle = `hsl(${hue * 360}, 100%, 50%)`;
                  }
                  else {
                    ctx.strokeStyle = selectedColor;
                  }
                  ctx.lineJoin = 'round';
                  ctx.lineCap = 'round';
                  ctx.lineWidth = brushSize;
                  ctx.globalAlpha = brushOpacity/255;
                  if (lastX !== 0 && lastY !== 0) {
                    ctx.beginPath();
                    ctx.moveTo(lastX, lastY);
                    ctx.lineTo(e.offsetX, e.offsetY);
                    ctx.stroke();
                  }
                  [lastX, lastY] = [e.offsetX, e.offsetY];
                }
            }

            function undo() {
              if (pointer > 0) {
                pointer--;
                const state = actions[pointer-1];
                canvas.width = state.width;
                canvas.height = state.height;
                ctx.putImageData(state.data, 0, 0);
              }
            }

            function redo() {
              if (pointer === actions.length ) return;
              pointer++;
              const state = actions[pointer-1];
              canvas.width = state.width;
              canvas.height = state.height;
              ctx.putImageData(state.data, 0, 0);
            }

            function cancel(){
              ctx.drawImage(tempCanvas,0,0);
              tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
              selectMenuDraw();
              resetFilters();
              clicks = null;
			        clicks = [];
            }

            function create(){
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              ctx.drawImage(tempCanvas,0,0);
              tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
              addAction();
              selectMenuDraw();
              resetFilters();
              clicks = null;
			        clicks = [];
            }

            function resetFilters(){
              hueSlider.value = 0;
              blurSlider.value = 0;
              contrastSlider.value = 100;
              exposureSlider.value = 0;
              brightnessSlider.value = 100;
              saturationSlider.value = 100;
              grayscaleSlider.value=0;
              tempCtx.clearRect(0, 0, canvas.width, canvas.height);
              TextSizeSlider.value=20;
              TextInput.value="";
              tempCtx.filter='none';
              ctx.filter='none';
            }

            function applyFilters() {
              const hue = document.getElementById("hue").value;
              const blur = document.getElementById("blur").value;
              const grayscale = document.getElementById("grayscale").value;
              const invert = document.getElementById("invert").value;
              const exposure = document.getElementById("exposure").value;
              const saturation = document.getElementById("saturation").value;
              const brightness = document.getElementById("brightness").value;
              const contrast = document.getElementById("contrast").value;
              const adjustedBrightness = brightness * Math.pow(2, exposure);
              const adjustedContrast = parseInt(contrast) + (exposure * 10);
              tempCtx.clearRect(0, 0, canvas.width, canvas.height);
              tempcanvas.width=cWidth;
              tempcanvas.height=cHeight;
              tempCtx.filter = `hue-rotate(${hue}deg) saturate(${saturation}%) brightness(${adjustedBrightness}%) contrast(${adjustedContrast}%) blur(${blur}px) grayscale(${grayscale}%) invert(${invert}%)`;
              tempCtx.drawImage(canvas, 0, 0);
            }

            function downloadCanvas() {
              const link = document.createElement('a');
              link.download = 'canvas.png';
              link.href = canvas.toDataURL();
              link.click();
            }
            
            //algorithm from https://ben.akrin.com/an-html5-canvas-flood-fill-that-doesnt-kill-the-browser/  #4 
            function flood_fill( original_x, original_y, color ) {
                original_color = ctx.getImageData( original_x, original_y, 1, 1 ).data ;
                original_color = { r:original_color[0],
                                   g:original_color[1],
                                   b:original_color[2],
                                   a:original_color[3] } ;
                x = original_x ;
                y = original_y ;
                boundary_pixels = ctx.getImageData( 0, 0, canvas.width, canvas.height ) ;
                linear_cords = (y * canvas.width + x) * 4 ;
                var done = false ;
                while( y>=0 && !done ) {
                    var new_linear_cords = ( (y-1) * canvas.width + x ) * 4 ;
                    if( boundary_pixels.data[new_linear_cords]==original_color.r &&
                        boundary_pixels.data[new_linear_cords+1]==original_color.g &&
                        boundary_pixels.data[new_linear_cords+2]==original_color.b &&
                        boundary_pixels.data[new_linear_cords+3]==original_color.a ) {
                        y = y - 1 ;
                        linear_cords = new_linear_cords ;
                    } else {
                        done = true ;
                    }
                }
                var path = [{x:x, y:y}] ;
                var first_iteration = true ;
                var iteration_count = 0 ;
                var orientation = 1 ; // 0:^, 1:<-, 2:v, 3:->
                while( !(path[path.length-1].x==path[0].x && path[path.length-1].y==path[0].y) || first_iteration ) {
                    iteration_count++ ;
                    first_iteration = false ;
                    var got_it = false ;
                    if( path.length>=2 ) {
                        if( path[path.length-1].y-path[path.length-2].y<0 ) {
                            orientation = 0 ;
                        } else if( path[path.length-1].x-path[path.length-2].x<0 ) {
                            orientation = 1 ;
                        } else if( path[path.length-1].y-path[path.length-2].y>0 ) {
                            orientation = 2 ;
                        } else if( path[path.length-1].x-path[path.length-2].x>0 ) {
                            orientation = 3 ;
                        } else {
                        }
                    }
                    for( var look_at=0 ; !got_it && look_at<=3 ; look_at++ ) {
                        var both = (orientation + look_at) % 4 ;
                        if( both==0 ) {
                            if( !got_it && (x+1)<canvas.width ) {
                                linear_cords = (y * canvas.width + (x+1)) * 4 ;
                                if( boundary_pixels.data[linear_cords]==original_color.r &&
                                    boundary_pixels.data[linear_cords+1]==original_color.g &&
                                    boundary_pixels.data[linear_cords+2]==original_color.b &&
                                    boundary_pixels.data[linear_cords+3]==original_color.a ) {
                                    got_it = true ;
                                    x = x + 1 ;
                                }
                            }
                        } else if( both==1 ) {
                            if( !got_it && (y-1)>=0 ) {
                                linear_cords = ((y-1) * canvas.width + x) * 4 ;
                                if( boundary_pixels.data[linear_cords]==original_color.r &&
                                    boundary_pixels.data[linear_cords+1]==original_color.g &&
                                    boundary_pixels.data[linear_cords+2]==original_color.b &&
                                    boundary_pixels.data[linear_cords+3]==original_color.a ) {
                                    got_it = true ;
                                    y = y - 1 ;
                                }
                            }
                        } else if( both==2 ) {
                            if( !got_it && (x-1)>=0 ) {
                                linear_cords = (y * canvas.width + (x-1)) * 4 ;
                                if( boundary_pixels.data[linear_cords]==original_color.r &&
                                    boundary_pixels.data[linear_cords+1]==original_color.g &&
                                    boundary_pixels.data[linear_cords+2]==original_color.b &&
                                    boundary_pixels.data[linear_cords+3]==original_color.a ) {
                                    got_it = true ;
                                    x = x - 1 ;
                                }
                            }
                        } else if( both==3 ) {
                            if( !got_it && (y+1)<canvas.height ) {
                                linear_cords = ((y+1) * canvas.width + x) * 4 ;
                                if( boundary_pixels.data[linear_cords]==original_color.r &&
                                    boundary_pixels.data[linear_cords+1]==original_color.g &&
                                    boundary_pixels.data[linear_cords+2]==original_color.b &&
                                    boundary_pixels.data[linear_cords+3]==original_color.a ) {
                                    got_it = true ;
                                    y = y + 1 ;
                                }
                            }
                        }
                    }
                    if( got_it ) {
                        path.push( {x:x, y:y} ) ;
                    }
                }
                draw_quadratic_curve( path, ctx, color, 1, color ) ;
            }
            function draw_quadratic_curve( path, ctx, color, thickness, fill_color ) {
                color = "rgba( " + color.r + "," + color.g + ","+ color.b + ","+ color.a + ")" ;
                fill_color = "rgba( " + fill_color.r + "," + fill_color.g + ","+ fill_color.b + ","+ fill_color.a + ")" ;
                ctx.strokeStyle = color ;
                ctx.fillStyle = fill_color ;
                ctx.lineWidth = thickness ;
                ctx.lineJoin = "round" ;
                ctx.lineCap = "round" ;
                if( path.length>0 ) { // just in case
                    if( path.length<3 ) {
                        var b = path[0] ;
                        ctx.beginPath() ;
                        ctx.arc( b.x, b.y, ctx.lineWidth / 2, 0, Math.PI * 2, !0 ) ;
                        ctx.fill() ;
                        ctx.closePath();
                    } else {
                        ctx.beginPath() ;
                        ctx.moveTo( path[0].x, path[0].y ) ;
                        for( var i = 1; i<path.length-2; i++ ) {
                            var c = (path[i].x + path[i + 1].x) / 2 ;
                            var d = (path[i].y + path[i + 1].y) / 2 ;
                            ctx.quadraticCurveTo( path[i].x, path[i].y, c, d ) ;
                        }
                        ctx.quadraticCurveTo( path[i].x, path[i].y, path[i + 1].x, path[i + 1].y ) ;
                        ctx.stroke() ;
                    }
                }
                if( fill_color!==false ) {
                    ctx.fill() ;
                }
            }
            function color_to_rgba( color ) {
                if( color[0]=="#" ) { // hex notation
                    color = color.replace( "#", "" ) ;
                    var bigint = parseInt(color, 16);
                    var r = (bigint >> 16) & 255;
                    var g = (bigint >> 8) & 255;
                    var b = bigint & 255;
                    return {r:r,
                            g:g,
                            b:b,
                            a:255} ;
                } else if( color.indexOf("rgba(")==0 ) { // already in rgba notation
                    color = color.replace( "rgba(", "" ).replace( " ", "" ).replace( ")", "" ).split( "," ) ;
                    return {r:color[0],
                            g:color[1],
                            b:color[2],
                            a:color[3]*255} ;
                }else if(color.indexOf("rgb(")==0){//in rgb notation
                  color = color.replace( "rgb(", "" ).replace( " ", "" ).replace( ")", "" ).split( "," ) ;
                  return {r:color[0],
                            g:color[1],
                            b:color[2],
                            a:255} ;
                } else {
                    console.error( "warning: can't convert color to rgba: " + color ) ;
                    return {r:0,
                            g:0,
                            b:0,
                            a:0} ;
                }
            }
        </script>
    </body>
</html>