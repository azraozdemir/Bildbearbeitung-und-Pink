<!DOCTYPE html>
<html>
    <head>
        <title>Drawing App</title>
        <style>
          /*general*/
            body {
              font-family: Arial, sans-serif;
              margin: 0vw;
              color: palevioletred;
            }
            @font-face {
            font-family: UWU;
            src: url(AkayaTelivigala-Regular.ttf);
            }
            @font-face {
            font-family: UWU2;
            src: url(HashedBrowns-WyJgn.ttf);
            }
            h1 {
            color: rgb(255, 255, 255);
            font-family: UWU2;
            font-size:2vw;
            text-align: center;
            margin:0px;
            }
            h2 {
            font-family: UWU;
            font-size: 2vw;
            color: rgb(255, 223, 228);
            text-align: left;
            margin:1vw;
            }
            b {
              font-size:1.3vw;
              margin:1vw;
            }

          /*switch*/
            .switch {
              position: relative;
              display: inline-block;
              width:5vw;
              height: 2.5vw;
              border-radius: 34px;
              margin: 0.4vw;
              right:3vw;
              top:0.8vw;
            }
            .switch input { 
              opacity: 0;
              width: 0;
              height: 0;
            }
            .slider {
              position: absolute;
              cursor: pointer;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background-color: #FDF1F4;
              -webkit-transition: .4s;
              transition: .4s;
              border-radius: 2vw;
            }
            .slider:before {
              position: absolute;
              content: "";
              height: 2vw;
              width: 2vw;
              left: 0.25vw;
              bottom:0.25vw;
              background-color: white;
              -webkit-transition: .4s;
              transition: .4s;
              border-radius: 50%;
            }
            input:checked + .slider {
              background-color: pink;
            }
            input:focus + .slider {
              box-shadow: 0 0 1px pink;
            }
            input:checked + .slider:before {
              -webkit-transform: translateX(2.5vw);
              -ms-transform: translateX(2.5vw);
              transform: translateX(2.5vw);
            }

          /*options*/
            .opt__box {
              position: relative;
              top:5.2vw;
              left: 0;
              width: 22vw;
              height: 45vw;
              list-style: none;
              padding:0vw;
              background: #fedee3;
              box-shadow: white;
              margin :0;
              border-radius: 0 0 0 0;
              z-index: 8;
            }

          /*info*/
            .info {
              background-color: #ffc2da;
              margin-top:5.2vw;
              z-index:9;
              width: 100%;
              text-align: left;
            }

          /*canvas*/
            #canvas {
              border: 1px solid black;
              margin: 0 auto;
              display: block;
              top:6vw;
              position:absolute;
              
            }
            #tempcanvas {
              border: 1px solid black;
              margin: 1 auto;
              display: block;
              top:6vw;
              position: absolute;
            }
            #cursercanvas {
              border: 1px solid black;
              margin: 1 auto;
              display: block;
              top:6vw;
              position: absolute;
            }
            #textinput {
              width: 20vw;
              height: 2vw;
              padding: 2px 2px;
              margin:1vw;
              box-sizing: border-box;
              border: 2px solid #fccce2;
              border-radius: 4px;
              background-color: #ffefef;
              resize: none;
            }
            .left30 {
              left:30%;
            }
            .left-100 {
              left:-100%;
            }
          /*opt_buttons*/
            .undoButton {
              margin:0.3vw;
              width: 4vw;
              height: 2vw;
              background-color: #ffbccd;
              border: none;
              border-radius: 15%;
              font-size: 1vw;
              color:#fff;
              cursor: pointer;
            }
            .redoButton {
              margin:0.3vw;
              width: 4vw;
              height: 2vw;
              background-color: #ffbccd;
              border: none;
              border-radius: 15%;
              font-size: 1vw;
              color:#fff;
              cursor: pointer;
            }
            .clearButton {
              margin:0.3vw;
              width: 4vw;
              height: 2vw;
              background-color: #ffbccd;
              border: none;
              border-radius: 15%;
              font-size: 1vw;
              color:#fff;
              cursor: pointer;
            }
            .undoButton:disabled {
              background-color: #ea9fb4;
            }
            .redoButton:disabled {
              background-color: #ea9fb4;
            }
            .clearButton:disabled {
              background-color: #ea9fb4;
            }
            .menuButtons {
              display: flex;
              justify-content: center;
            }
            .color {
              width: 2.5vw;
              height: 2.5vw;
              cursor: pointer;
              border: 1px solid rgb(255, 255, 255);
              margin:0.3vw;
              border-radius: 0.3vw;
            }
            .color:hover {
              opacity: 0.7;
            }
            #standardColors {
              display: flex;
              flex-wrap: wrap;
              justify-content: center;
            }
            #standardColorsText {
              display: flex;
              flex-wrap: wrap;
              justify-content: center;
            }
            .opt_slider {
              -webkit-appearance: none;
              width: 80%;
              height: 1vw;
              border-radius: 5px;  
              background: #fffafa;
              outline: none;
              opacity: 0.7;
              margin:1vw;
            }
            .opt_slider::-webkit-slider-thumb {
              -webkit-appearance: none;
              appearance: none;
              width: 1.3vw;
              height: 1.3vw;
              border-radius: 50%; 
              background: #ff83b5;
              cursor: pointer;
            }
            label {
              font-size: 1.3vw;
              margin:1vw
            }
            .box {
              width: 2px;
              height: 20px;
              background-color: #000000;
              animation-name: example;
              animation-duration: 1s;
              animation-iteration-count: infinite;
            }
            @keyframes example {
              0%   {background-color:rgb(0, 0, 0);}
              100% {background-color:#00000000;}
            }
            select #font-selector {
              width: 20vw;
              margin:1vw;
              color: #ff83b5;
            }
            .font-option {
              width: 20vw;
              height: 2vw;
              padding: 2px 2px;
              margin:1vw;
              box-sizing: border-box;
              border: 2px solid #fccce2;
              border-radius: 4px;
              background-color: #ffefef;
              color:#ea9fb4
            }
            #font-select {
              width:20;
            }

            /*navbar*/
            .navbar {
              background-color: #ffc2da;
              overflow: hidden;
              position: fixed;
              top: 0;
              left:0;
              width: 100%;
              margin: 0;
              padding: 0;
              z-index: 10;
            }
            .navbar a.tab{
              float: left;
              display: block;
              color: #fff;
              text-align: center;
              padding: 10vw;
              text-decoration: none;
              font-size: 1.5vw;
              transition: all 0.3s ease;
              cursor: pointer;
            }
            .navbar a:hover {
              background-color: #ffcfe1;
            }
            .navbar a.menu_item_selected {
              background-color: #ffa8cb;
              color: white;
            }
            .underline-slide {
              position: absolute;
              bottom: 0;
              height: 3px;
              background-color: #ff8ebb;
              transition: all 0.5s ease;
            }
            .resp_img {
              width: 8vw;
              padding: 0;
              margin:5px;
              float: left;
            }

            /* layers */
            .layer-box {
              position: absolute;
              top:5.2vw;
              right: 0;
              width: 22vw;
              height: 45vw;
              list-style: none;
              padding:0vw;
              background: #fedee3;
            }
            .layer-container {
              margin-top: 10px;
            }
            .layer-image {
              display: inline-block;
              width: 50px;
              height: 50px;
              vertical-align: middle;
              border: 1px solid black;
              margin-right: 10px;
            }
            .layer-checkbox {
              vertical-align: middle;
            }
            .layer-container.highlighted {
              background-color: rgb(255, 235, 236);
            }
          /*dark-mode*/

        </style>
    </head>
    <body>
      <div class="navbar">
        <a class="resp_img"href="index.html"><img src="pics/icons/logo_schrift.png" class="resp_img"  ></a>
        <a  class="menu_item_selected tab"onclick="selectMenuDraw()" id="menu_draw" style="padding:1.7vw;">Draw</a>
        <a  class="tab"onclick="selectMenuFilters()" id="menu_filters"style="padding:1.7vw;">Filters</a>
        <a class="tab"onclick="selectMenuFroms()"id="menu_forms"style="padding:1.7vw;">Forms</a>
        <a class="tab"onclick="selectMenuText()" id="menu_text"style="padding:1.7vw;">Text</a>
        <a class="tab"onclick="selectMenuLoad()"id="menu_load"style="padding:1.7vw;">Image</a>
        <label class="switch" style="float: right;">
          <input type="checkbox" id="toggle-mode"onclick="changecolor()">
          <span class="slider"></span>
        </label>
      </div><!--navbar-->
        <div>
            <canvas id="canvas" width="500" height="500"></canvas>
            <canvas id="tempcanvas" width="500" height="500"></canvas>
            <canvas id="cursercanvas" width="500"height="500"></canvas>
            <div class="box" hidden="true" id="textcursor"></div><!--cursor-->
        </div><!--canvas -->
        <div>
            <ul class="opt__box">
              <br>
                <div id="opt_draw">
                  <div id="standardColors">
                    <input  class="color" type="color" id="colorPicker" value="#000000">
                    <div class="color rbw"id="rainbowButton" style="width: 2.5vw; height: 2.5vw; background: linear-gradient( to bottom right,rgb(255, 122, 122),rgb(255, 255, 26),rgb(141, 255, 141),rgb(112, 112, 255),rgb(215, 160, 255),violet); cursor: pointer;"></div>
                    <div class="color" style="background-color: #000000;"></div>
                    <div class="color" style="background-color: #FF0000;"></div>
                    <div class="color" style="background-color: #00FF00;"></div>
                    <div class="color" style="background-color: #0000FF;"></div>
                    <div class="color" style="background-color: #FFFF00;"></div>
                    <div class="color" style="background-color: #FF00FF;"></div>
                    <div class="color" style="background-color: #00FFFF;"></div>
                    <div class="color" style="background-color: #FFFFFF;"></div>
                    <div class="color" style="background-color: #FFA500;"></div>
                    <div class="color" style="background-color: #8c00ff;"></div>
                    <img src="pics/eraser.png" class="color ers" id="eraser" width="2.5vw"height="2.5vw">
                    <img src="pics/bucket.png" class="color fill" id="fill" width="2.5vw"height="2.5vw">
                  </div>
                  <br>
                  <label for="brushSize">Brush Size:</label>
                  <input class="opt_slider" type="range" id="brushSize" min="1" max="150" value="10">
                  <label for="brushOpacity">Opacity:</label>
                  <input class="opt_slider" type="range" id="brushOpacity" min="1" max = "255" value="255">
                </div>
                <div id="opt_filters"  hidden="true">
                  <label for="hue">Hue:</label>
                  <input class="opt_slider"type="range" id="hue" min="-180" max="180" value="0">
                  <label for="blur">Blur:</label>
                  <input class="opt_slider"type="range" id="blur" min="0" max="25" step="0.1" value="0">
                  <label for="contrast">Contrast:</label>
                  <input class="opt_slider"type="range" id="contrast" min="0" max="200"  value="100">
                  <label for="exposure">Exposure:</label>
                  <input class="opt_slider"type="range" id="exposure" min="-5" max="5" step="0.1" value="0">
                  <label for="brightness">Brightness:</label>
                  <input class="opt_slider"type="range" id="brightness" min="0" max="200" value="100">
                  <label for="saturation">Saturation:</label>
                  <input class="opt_slider"type="range" id="saturation" min="0" max="200" value="100">
                  <label for="grayscale">Gray-scale:</label>
                  <input class="opt_slider"type="range" id="grayscale" min="0" max="100" value="0">
                  <label for="invert">Invert</label>
                  <input class="opt_slider"type="range" id="invert" min="0" max="100" value="0">
                </div>
                <div id="opt_forms"  hidden="true">
                  <div id="forms-selector">
                    <label >Form:</label>
                    <select id="forms-select" size="1">
                      <option value="forms_line" class="forms-option">Line</option>
                      <option value="forms_tri" class="forms-option">Triangle</option>
                      <option value="forms_rect" class="forms-option">Rectangle</option>
                      <option value="forms_circle" class="forms-option">Circle</option>
                      <option value="forms_elypse" class="forms-option">Elipse</option>
                      <option value="forms_anygon" class="forms-option">Any-Gon</option>
                      <option value="forms_polygon" class="forms-option">Polygon</option>
                      <option value="forms_heart" class="forms-option">Heart</option>
                    </select>
                  </div>
                  <div id="forms-type-selector">
                    <label >DrawMode:</label>
                    <select id="forms-type-select" size="1">
                      <option value="o" class="forms-option">Outline</option>
                      <option value="f" class="forms-option">Fill</option>
                      <option value="of" class="forms-option">OutLine+Fill</option>
                    </select>
                  </div>
                  <input  class="color" type="color" id="colorPicker_f1" value="#000000">
                  <input  class="color" type="color" id="colorPicker_f2" value="#000000">
                  <div id="forms_line"hidden=true>
                  </div>
                  <div id="forms_tri"hidden=true>
                    <label >Rectangular:</label>
                    <input value="true"type="checkbox" id="f_tri_bx">
                  </div>
                  <div id="forms_rect"hidden=true>
                    <label >f_corners:</label>
                    <input class="opt_slider" type="range" id="f_corners" min="0" max = "50" value="0">
                  </div>
                  <div id="forms_circle"hidden=true>
                  </div>
                  <div id="forms_elypse"hidden=true>
                  </div>
                  <div id="forms_anygon"hidden=true>
                  </div>
                  <div id="forms_polygon"hidden=true>
                    <input class="opt_slider" type="range" id="f_pcorners" min="2" max = "16" value="6">
                    <p id ="f_p_txt"></p>
                  </div>
                  <div id="forms_heart"hidden=true>
                  </div>
                </div>
                <div id="opt_text"  hidden="true">
                  <div id="standardColorsText">
                    <input  class="color pik" type="color" id="colorPickerText" value="#000000">
                    <div class="color" style="background-color: #000000;"></div>
                    <div class="color" style="background-color: #FF0000;"></div>
                    <div class="color" style="background-color: #00FF00;"></div>
                    <div class="color" style="background-color: #0000FF;"></div>
                    <div class="color" style="background-color: #FFFF00;"></div>
                    <div class="color" style="background-color: #FF00FF;"></div>
                    <div class="color" style="background-color: #00FFFF;"></div>
                    <div class="color" style="background-color: #FFFFFF;"></div>
                    <div class="color" style="background-color: #FFA500;"></div>
                    <div class="color" style="background-color: #8c00ff;"></div>
                  </div>
                  <label for="Textsize">Size:</label>
                  <input class="opt_slider"type="range" id="Textsize" min="10" max="200" value="20">
                  <div id="font-selector">
                  <label for="font-select">Font:</label>
                    <select id="font-select" size="1">
                      <option style="font-family:Arial;" value="Arial" class="font-option">Arial</option>
                      <option style="font-family:Verdana;" value="Verdana" class="font-option">Verdana</option>
                      <option style="font-family:Tahoma;" value="Tahoma" class="font-option">Tahoma</option>
                      <option style="font-family:Trebuchet MS;" value="Trebuchet MS" class="font-option">Trebuchet MS</option>
                      <option style="font-family:Impact;" value="Impact" class="font-option">Impact</option>
                      <option style="font-family:Comic Sans MS;" value="Comic Sans MS" class="font-option">Comic Sans MS</option>
                      <option style="font-family:Georgia;" value="Georgia" class="font-option">Georgia</option>
                      <option style="font-family:Times New Roman;" value="Times New Roman" class="font-option">Times New Roman</option>
                      <option style="font-family:Courier New;" value="Courier New" class="font-option">Courier New</option>
                      <option style="font-family:Lucida Console;" value="Lucida Console" class="font-option">Lucida Console</option>
                      <option style="font-family:Tahoma;" value="Tahoma" class="font-option">Tahoma</option>
                      <option style="font-family:Arial Black;" value="Arial Black" class="font-option">Arial Black</option>
                      <option style="font-family:Garamond;" value="Garamond" class="font-option">Garamond</option>
                      <option style="font-family:Helvetica;" value="Helvetica" class="font-option">Helvetica</option>
                      <option style="font-family:Wide Latin;" value="Wide Latin" class="font-option">Wide Latin</option>
                      <option style="font-family:Cooper Black;" value="Cooper Black" class="font-option">Cooper Black</option>
                      <option style="font-family:Mistral;" value="Mistral" class="font-option">Mistral</option>
                    </select>
                  </div>
                  <label for="textinput">Text:</label><br>
                  <textarea id="textinput"></textarea>
                </div>
                <div id="opt_load"  hidden="true">
                  <button id="downloadButton">Download</button>
                  <input type="file" id="imageUpload">
                </div>
            </ul>
        </div><!--option box -->
        <div>
          <div class="layer-box">
            <li class="menuButtons"><button class="undoButton"id="undoButton">Undo</button><button class="redoButton"id="redoButton">Redo</button><button class="clearButton"id="clearButton">Clear</button></li>
            <div>
              <label for="layer-select">Layer:</label>
              <select id="layer-select"></select>
              <button id="add-layer-btn">New Layer</button>
              <button id="delete-layer-btn">Delete Layer</button>
              <button id="duplicate-layer-btn">Duplicate Layer</button>
              <button id="merge-layers-btn">Merge Layers</button>
              <button id="layer-up-btn">Layer Up</button>
              <button id="layer-down-btn">Layer Down</button>
            </div>
            <div id="layers-container"></div>
          </div>
        </div><!--layer box-->
        <div class="info">
          <!-- @azra hier info dazutuhen bei jedem-->
            <div id="info_draw">
              <b>
                <h1>Documentation / Draw:</h1>
                  <h2>Color selection:</h2>
                  To select colors, there is a palette with predefined colors located in the top right corner. If you click on the first black box, you can also create a custom color by simply clicking on a spot with the desired color.
                  
                  <h2>Eraser:</h2>
                  The eraser is used to delete the areas you want to remove, just click on the canvas.
                  
                  <h2>Fill entire canvas:</h2>
                  The bucket symbol is used to fill an area with a colour, just click and drag on the canvas.
                  
                  <h2>Brush size:</h2>
                  The "Brush Size" refers to the size of the brush or drawing tools. With a larger brush size, you can create broader lines or areas, while a smaller brush size allows for finer details.
                  
                  <h2>Opacity:</h2>
                  The "Opacity" determines how transparent or opaque the applied stroke of color is to achieve different effects and create shading or overlays. </b>
            </div>
            <div id="info_filters" hidden="true">
                <b>
                  <h1>Documentation / Filters</h1>
                  <h2>FILTERS:
                  Hue, Blur, Contrast, Exposure, Brightness, Saturation, Gray-scale, Invert</h2>
                  <br>
                  Hue: Adjusts the color tone.<br>
                  Blur: Blurs or softens images.<br>
                  Contrast: Adjusts the differences between light and dark areas.<br>
                  Exposure: Controls the brightness of the image.<br>
                  Brightness: Controls the overall brightness of the image.<br>
                  Saturation: Adjusts the intensity of colors.<br>
                  Gray-scale: Converts the image to black and white.<br>
                  Invert: Reverses colors and contrasts.<br>
                </b>
            </div>
            <div id="info_forms" hidden="true">
                <b>
                  <h1>Documentation / Shapes</h1>
                  <h2>Shape:</h2> In this section, you can enter the desired shape. To Make a Shape, choose one from the dropdown menue and click and drag on the canvas.
                  <h2>DrawMode:</h2> This option allows you to specify whether the inner part, outer part, or both of the shape should be filled.<br>
                  <h2>line:</h2>makes a basic line
                  <h2>Trianle:</h2>makes a basic tricangle, check the box to make it with an 90° angle
                  <h2>Rectangle:</h2>makes a basic rectangle, you can make the corners round
                  <h2>Circle:</h2>makes a circle 
                  <h2>Elypse:</h2>makes a elypse(a wierd circle)
                  <h2>Any-Gon:</h2>makes any kind of shape with straight edges. ad corners by clicking on the canvas
                  <h2>Poly-Gon:</h2>makes a shape with at least two corners, you can adjust the amount of corners
                  <h2>hears:</h2>creates a heart!
                </b>
            </div>
            <div id="info_text" hidden="true">
                <b>
                  <h1>Documentation / Text</h1>
                    on the canvas click and drag to moce the curser
                    <h2>Colors:</h2> Inside the boxes, you can select your desired font color. The first black box allows you to create your own color by clicking on the desired color with the mouse.
                    <h2>Size:</h2> Decide how big the text should be.
                    <h2>Font:</h2> Here, you can select and use the desired font style.
                    <h2>Text:</h2> In the table, you can enter your text and position it within the frame.
                </b>
            </div>
            <div id="info_load" hidden="true">
                <b>
                  <h1>Documentation / Image</h1>
                </b>
            </div>
            <b>
              <h1>Documentation / Layers</h1>
            </b>
        </div><!--info box -->
        <!--@lela hier footer einfügen-->
        <script>
/*------------------------------------------script----------------------------------------*/
          /*static management*/
          function unselectAllMenu(){
            if(modeFilters||modeForms||modeText){
              saveHistory();
            }
            var element = document.getElementById("menu_draw").classList.remove("menu_item_selected");
            element = document.getElementById("menu_filters").classList.remove("menu_item_selected");
            element = document.getElementById("menu_forms").classList.remove("menu_item_selected");
            element = document.getElementById("menu_text").classList.remove("menu_item_selected");
            element = document.getElementById("menu_load").classList.remove("menu_item_selected");
            document.getElementById("undoButton").disabled = false;
            document.getElementById("redoButton").disabled = false;
            document.getElementById("clearButton").disabled = false;
            modeDraw = false;
            modeFilters = false;
            modeForms = false;
            modeText = false;
            modeLoad = false;
            isDrawing=false;
            element=document.getElementById("tempcanvas");
            element.classList.add("left-100");
            element.classList.remove("left30");
            element=document.getElementById("cursercanvas");
            element.classList.add("left-100");
            element.classList.remove("left30");
            element=document.getElementById("canvas");
            element.classList.add("left30");
            element.classList.remove("left-100");
            element=document.getElementById("textcursor");
            element.hidden=true;
            resetFilters();
          }
          function unloadAllOptions(){
            var element = document.getElementById("opt_draw");
            element.hidden=true;
            element = document.getElementById("opt_filters");
            element.hidden=true;
            element = document.getElementById("opt_forms");
            element.hidden=true;
            element = document.getElementById("opt_text");
            element.hidden=true;
            element = document.getElementById("opt_load");
            element.hidden=true;
          }
          function unloadAllInfo(){
            var element = document.getElementById("info_draw");
            element.hidden=true;
            element = document.getElementById("info_filters");
            element.hidden=true;
            element = document.getElementById("info_forms");
            element.hidden=true;
            element = document.getElementById("info_text");
            element.hidden=true;
            element = document.getElementById("info_load");
            element.hidden=true;
          }

          function selectMenuDraw(){
            unselectAllMenu();
            unloadAllOptions();
            unloadAllInfo();
            var element = document.getElementById("menu_draw");
            element.classList.add("menu_item_selected");
            element = document.getElementById("opt_draw");
            element.hidden=false;
            element = document.getElementById("info_draw");
            element.hidden=false;
            modeDraw=true;
          }
          function selectMenuFilters(){
            unselectAllMenu();
            unloadAllOptions();
            unloadAllInfo();
            var element = document.getElementById("menu_filters").classList.add("menu_item_selected");
            element = document.getElementById("opt_filters").hidden=false;
            element = document.getElementById("info_filters").hidden=false;
            document.getElementById("undoButton").disabled = true;
            document.getElementById("redoButton").disabled = true;
            document.getElementById("clearButton").disabled = true;
            tempCtx.clearRect(0,0,cWidth,cHeight);
            curserCtx.clearRect(0,0,cWidth,cHeight);
            curserCtx.drawImage(layers[currentLayerIndex],0,0);
            modeFilters=true;
          }
          function selectMenuFroms(){
            unselectAllMenu();
            unloadAllOptions();
            unloadAllInfo();
            var element = document.getElementById("menu_forms").classList.add("menu_item_selected");
            element = document.getElementById("opt_forms").hidden=false;
            element = document.getElementById("info_forms").hidden=false;
            element = document.getElementById("forms_line").hidden=false;
            modeForms = true;
          }
          function selectMenuText(){
            unselectAllMenu();
            unloadAllOptions();
            unloadAllInfo();

            drawTextCurser();
            var element = document.getElementById("menu_text").classList.add("menu_item_selected");
            element = document.getElementById("opt_text").hidden=false;
            element=document.getElementById("textcursor").hidden=false;
            element=document.getElementById("textinput").focus();
            modeText=true;
            element = document.getElementById("info_text");
            element.hidden=false;
          }
          function selectMenuLoad(){
            unselectAllMenu();
            unloadAllOptions();
            unloadAllInfo();
            var element = document.getElementById("menu_load");
            element.classList.add("menu_item_selected");
            element = document.getElementById("opt_load");
            element.hidden=false;
            element = document.getElementById("info_load");
            element.hidden=false;
            modeLoad=true;
          }
  /*-----------------here all functinsfor canvas begin------------------*/
          /*initialisation*/
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const tempCanvas= document.getElementById('tempcanvas');
            const tempCtx= tempcanvas.getContext('2d');
            const curserCanvas = document.getElementById('cursercanvas');
            const curserCtx=curserCanvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let curserX=0;
            let curserY=0;
            let brushSize = 10;
            let brushOpacity=255;
            let selectedColor = '#000000';
            let isRainbowMode = false;
            let isEraseMode=false;
            let isFillMode=false;
            let modeDraw=true;
            let modeFilters = false;
            let modeForms = false;
            let modeText = false;
            let modeLoad = false;
            let image;
            let cWidth=500;
            let cHeight=500;
            let mouse_Down=false;
            let selectedFont= "Arial";
            let selectedform="forms_line";
            let x = 50;
		        let y = 50;
		        let isResizing = false;
            let isrectangular = true;
            let clicks = [];
            let corners=f_pcorners.value;
            let forms_c1='#000000';
            let forms_c2='#dddddd';
            let form_type="o";
            let f_x2=0;
            let f_y2=0;
            let layers = [];
            let currentLayerIndex = 0;
            let layerHistory = [[]];
            let historyIndex = 0;
          /*consts*/
            const layersContainer = document.getElementById('layers-container');
            const deleteLayerBtn = document.getElementById('delete-layer-btn');
            const mergeLayersBtn = document.getElementById('merge-layers-btn');
            const layerUpBtn = document.getElementById('layer-up-btn');
            const layerDownBtn = document.getElementById('layer-down-btn');
            const duplicateLayerBtn = document.getElementById('duplicate-layer-btn');
            const fontSelect = document.getElementById("font-select");
            const formSelect = document.getElementById("forms-select");
            const formtypeSelect = document.getElementById("forms-type-select");
            const clearButton = document.getElementById('clearButton');
            const undoBtn = document.getElementById('undoButton');
            const redoBtn = document.getElementById('redoButton');
            const colorPicker = document.getElementById('colorPicker');
            const colorPicker_f1 = document.getElementById('colorPicker_f1');
            const colorPicker_f2 = document.getElementById('colorPicker_f2');
            const colorPickerText = document.getElementById('colorPickerText');
            const standardColors = document.getElementById('standardColors');
            const standardColorsText = document.getElementById('standardColorsText');
            const brushSizeInput = document.getElementById('brushSize');
            const brushOpacityInput = document.getElementById('brushOpacity');
            const downloadButton = document.getElementById('downloadButton');
            const TextSizeSlider = document.getElementById("Textsize");
            const TextInput = document.getElementById("textinput");
            const hueSlider = document.getElementById("hue");
            const blurSlider = document.getElementById("blur");
            const contrastSlider = document.getElementById("contrast");
            const brightnessSlider = document.getElementById("brightness");
            const saturationSlider = document.getElementById("saturation");
            const showHideButton = document.getElementById("showHideButton");
            const sliderWrapper = document.getElementById("sliderWrapper");
            const exposureSlider = document.getElementById("exposure");
            const grayscaleSlider = document.getElementById("grayscale");
            const f_cornersSlider = document.getElementById("f_corners");
            const f_pcornersSlider = document.getElementById("f_pcorners");
            const invertSlider=document.getElementById("invert");
            const fill =document.getElementById("fill");
            const form_Line = document.getElementById("forms_line");
            const form_Tri = document.getElementById("forms_tri");
            const form_Rect = document.getElementById("forms_rect");
            const form_Circle = document.getElementById("forms_circle");
            const form_Elypse = document.getElementById("forms_elypse");
            const form_Anygon = document.getElementById("forms_anygon");
            const form_Polygon = document.getElementById("forms_polygon");
            const form_Heart = document.getElementById("forms_heart");
            const checkBox = document.getElementById("f_tri_bx");
            const imageUpload = document.getElementById('imageUpload');

          /*startfunctions*/
            createLayer();
            selectMenuDraw();

          /*eventlisterns*/
            document.getElementById('layer-select').addEventListener('change', switchLayer);
            document.getElementById('add-layer-btn').addEventListener('click', createLayer);
            duplicateLayerBtn.addEventListener('click', duplicateLayer);
            layerDownBtn.addEventListener('click', moveLayerDown);
            layerUpBtn.addEventListener('click', moveLayerUp);
            mergeLayersBtn.addEventListener('click', mergeLayers);
            deleteLayerBtn.addEventListener('click', deleteLayer);
            checkBox.addEventListener('change',function(){
              isrectangular=!isrectangular;
            });
            clearButton.addEventListener('click', clearCanvas);
            undoButton.addEventListener('click', undo);
            redoButton.addEventListener('click', redo);
            downloadButton.addEventListener('click', downloadCanvas);
            TextSizeSlider.addEventListener("input",drawTextCurser);
            exposureSlider.addEventListener("input", applyFilters);
            grayscaleSlider.addEventListener("input",applyFilters);
            invertSlider.addEventListener("input",applyFilters);
            hueSlider.addEventListener("input", applyFilters);
            blurSlider.addEventListener("input", applyFilters);
            contrastSlider.addEventListener("input", applyFilters);
            brightnessSlider.addEventListener("input", applyFilters);
            TextInput.addEventListener("input",drawTextCurser);
            saturationSlider.addEventListener("input", applyFilters);

            canvas.addEventListener('mousedown', (e) => {
              if(modeDraw){
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
                if(isFillMode){
                  flood_fill(lastX,lastY,color_to_rgba(selectedColor));
                }
              }
              else if(modeForms){
                x= event.clientX - canvas.offsetLeft;
                y= event.clientY - canvas.offsetTop;
                isResizing = true;
                if(selectedform=="forms_anygon"){
                  clicks.push({
                  x: event.offsetX,
                  y: event.offsetY
                  });
                  tempCtx.clearRect(0, 0, canvas.width, canvas.height);
                  if(form_type=="f"){
                    tempCtx.strokeStyle='#00000000';
                    tempCtx.fillStyle =forms_c2;
                  }
                  else if(form_type=="o"){
                    tempCtx.strokeStyle=forms_c1;
                    tempCtx.fillStyle ='#00000000';
                  }
                  else if(form_type=="of"){
                    tempCtx.strokeStyle=forms_c1;
                    tempCtx.fillStyle =forms_c2;
                  }
                  tempCtx.lineWidth = 1;
                  tempCtx.beginPath();
                  tempCtx.moveTo(clicks[0].x, clicks[0].y);
                  for(var i=1; i < clicks.length; i++) { 
                    tempCtx.lineTo(clicks[i].x,clicks[i].y);
                  }
                  tempCtx.closePath();
                  tempCtx.fill();
                  tempCtx.stroke();

                  ctx.clearRect(0, 0, canvas.width, canvas.height);
                    layers.forEach((layer, index) => {
                      const layerCtx = layer.getContext('2d');
                      const layerCheckbox = document.querySelector(`#layer-${index}-checkbox`);
                      if (layerCheckbox.checked) {
                        if(index==currentLayerIndex){
                          layerCtx.clearRect(0, 0, canvas.width, canvas.height);
                          layerCtx.drawImage(tempCanvas,0,0);
                        }
                      }
                    });
                    const layerPreviewImage = document.querySelector(`#layer-${currentLayerIndex}-preview`);
                    layerPreviewImage.src = layers[currentLayerIndex].toDataURL();
                    drawCurrentCanvas();
                }
              }
              else  if(modeText){
                [lastX, lastY] = [e.offsetX, e.offsetY];
                [curserX,curserY]=[e.x,e.y];
                drawTextCurser(e);
                mouse_Down=true;
              }
            });

            canvas.addEventListener('mousemove', (e)=>{
              if(modeDraw){
                draw(e);                
              }
              else if(modeForms){
                drawforms(e);
              }
              else   if(mouse_Down){
                if(modeText){
                  [lastX, lastY] = [e.offsetX, e.offsetY];
                  [curserX,curserY]=[e.x,e.y];
                  drawTextCurser(e);
                }
              }
            });
            canvas.addEventListener('mouseup', () => {
              if(modeDraw){
                isDrawing = false;
                saveHistory();
              }
              else if(modeForms){
                isResizing = false;
              }
              else if(modeText){
                mouse_Down=false;
              }
            });
            canvas.addEventListener('mouseout',(e)=>{
              if(modeText){
                mouse_Down=false;
              }
            });
            curserCanvas.addEventListener('mousedown',(e)=>{
              if(modeText){
                [lastX, lastY] = [e.offsetX, e.offsetY];
                [curserX,curserY]=[e.x,e.y];
                drawTextCurser(e);
                mouse_Down=true;
              }
            });
            curserCanvas.addEventListener('mouseup',(e)=>{
              if(modeText){
                mouse_Down=false;
              }
            });
            curserCanvas.addEventListener('mouseout',(e)=>{
              if(modeText){
                mouse_Down=false;
              }
            });
            curserCanvas.addEventListener('mousemove',(e)=>{
              if(mouse_Down){
                if(modeText){
                  [lastX, lastY] = [e.offsetX, e.offsetY];
                  [curserX,curserY]=[e.x,e.y];
                  drawTextCurser(e);
                }
              }
            });
            colorPicker.addEventListener('change', () => {
              selectedColor = colorPicker.value;
            });
            colorPicker_f1.addEventListener('change', () => {
              forms_c1 = colorPicker_f1.value;
            });
            colorPicker_f2.addEventListener('change', () => {
              forms_c2 = colorPicker_f2.value;
            });
            standardColors.addEventListener('click', (e) => {
              if (e.target.classList.contains('color')) {
                isRainbowMode=false;
                  isEraseMode=false;
                  isFillMode=false;
                if (e.target.classList.contains('rbw')){
                  isRainbowMode=true
                }
                else if (e.target.classList.contains('ers')){
                  isEraseMode=true;
                }
                else if (e.target.classList.contains('fill')){
                  isFillMode=true;
                }
                else{
                  selectedColor = e.target.style.backgroundColor;
                  colorPicker.value = selectedColor;
                }
              }
            });
            colorPickerText.addEventListener('change', () => {
              selectedColor = colorPickerText.value;
              drawTextCurser(null);
            });
            standardColorsText.addEventListener('click', (e) => {
              if (e.target.classList.contains('color')) {
                if (e.target.classList.contains('pik')) {
                  selectedColor = colorPickerText.value;
                }
                else{
                  selectedColor = e.target.style.backgroundColor;
                  colorPicker.value = selectedColor;
                }
                drawTextCurser(null);
              }
            });
            standardColorsText.addEventListener('click', (e) => {
              if (e.target.classList.contains('color')) {
                  selectedColor = e.target.style.backgroundColor;
              }
            });
            brushSizeInput.addEventListener('input', () => {
              brushSize = brushSizeInput.value;
            });
            brushOpacityInput.addEventListener('input', () => {

              brushOpacity = brushOpacityInput.value;
            });
            fontSelect.addEventListener("change", function() {
			        selectedFont = fontSelect.value;
              drawTextCurser(null);
		        });
            formSelect.addEventListener("change",function(){
              selectedform=formSelect.value;
              const forms =["forms_line","forms_tri","forms_rect","forms_circle","forms_elypse","forms_anygon","forms_polygon","forms_heart"];
              for(var i=0; i < forms.length; i++) { 
                var element = document.getElementById(forms[i]);
                if(selectedform==forms[i]) element.hidden=false;
                else element.hidden=true;
              }
            });
            formtypeSelect.addEventListener("change",function(){
              form_type=formtypeSelect.value;
            });
            f_pcorners.addEventListener("change",function(){
              corners=f_pcorners.value;
              var mouseX = f_x2;
                  var mouseY = f_y2;
                    changecornerswoe(event);
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(canvas, 0, 0);
                    var a = mouseX-x;
                    var b = mouseY-y;
                    if(a<0)a=a*(-1);
                    if(b<0)b=b*(-1);
                    var r= Math.max(a,b)/2;
                    tempCtx.beginPath();
                    tempCtx.moveTo(clicks[0]._x,clicks[0]._y);//(clockwise)
                    for(var i=1; i < clicks.length; i++) { 
                      tempCtx.lineTo(clicks[i]._x,clicks[i]._y);
                    }
                    f_x2=mouseX;
                    f_y2=mouseY;
                  tempCtx.closePath();
                tempCtx.fill();
                tempCtx.stroke();
            });
            f_cornersSlider.addEventListener("change",function(){
              var mouseX = f_x2;
                  var mouseY =f_y2;
                    width = mouseX - x;
                    height = mouseY - y;
                    tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(canvas, 0, 0);
                    tempCtx.beginPath();
                    tempCtx.roundRect(x, y, width, height,f_cornersSlider.value);//(0°rounded corners)
                    f_x2=mouseX;
                    f_y2=mouseY;
                    tempCtx.closePath();
                tempCtx.fill();
                tempCtx.stroke();
            });
            window.addEventListener('DOMContentLoaded', (event) => {
              const navbar = document.querySelector('.navbar');
              const tabs = navbar.getElementsByClassName('tab');
              const underline = document.createElement('div');
              underline.classList.add('underline-slide');
              navbar.appendChild(underline);
              let activeTab = navbar.querySelector('.menu_item_selected');
              if (activeTab) {
                underline.style.width = activeTab.offsetWidth + 'px';
                underline.style.transform = `translateX(${activeTab.offsetLeft}px)`;
              }
              for (let i = 0; i < tabs.length; i++) {
                tabs[i].addEventListener('click', function () {
                  if (activeTab) {
                    activeTab.classList.remove('menu_item_selected');
                  }
                  activeTab = this;
                  activeTab.classList.add('menu_item_selected');
                  underline.style.width = activeTab.offsetWidth + 'px';
                  underline.style.transform = `translateX(${activeTab.offsetLeft}px)`;
                });
              }
              navbar.addEventListener('mouseleave', function () {
                if (activeTab) {
                  underline.style.width = activeTab.offsetWidth + 'px';
                  underline.style.transform = `translateX(${activeTab.offsetLeft}px)`;
                }
              });
              navbar.addEventListener('mouseover', function (e) {
                if (e.target.classList.contains('tab')) {
                  const targetTab = e.target;
                  underline.style.width = targetTab.offsetWidth + 'px';
                  underline.style.transform = `translateX(${targetTab.offsetLeft}px)`;
                }
              });
            });
            imageUpload.addEventListener('change', (e) => {
              const file = e.target.files[0];
              const reader = new FileReader();
              reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                  if(canvas.width<img.width||canvas.height<img.height){
                  canvas.width = img.width;
                  canvas.height = img.height;}
                  ctx.drawImage(img, 0, 0);
                }
                img.src = event.target.result;
              }
              reader.readAsDataURL(file);
              saveHistory();
            });
          
            /*functions*/
            function deleteLayer() {
              if (layers.length > 1) {
                layers.splice(currentLayerIndex, 1);
                const layerContainer = document.getElementById(`layer-${currentLayerIndex}-container`);
                layerContainer.remove();
                redrawLayers();
              }
              saveHistory();
            }

            function createLayer() {
              const layer = document.createElement('canvas');
              layer.width = canvas.width;
              layer.height = canvas.height;
              layers.push(layer);
              const layerIndex = layers.length - 1;
              const option = document.createElement('option');
              option.value = layerIndex;
              option.text = `Layer ${layerIndex + 1}`;
              document.getElementById('layer-select').appendChild(option);
              addLayerToContainer(layerIndex);
              const layerContainer = document.querySelector(`#layer-${layerIndex}-container`);
              if (layers.length === 1) {
                layerContainer.classList.add('highlighted');
              }
              saveHistory();
            }

            function switchLayer() {
              const layerIndex = parseInt(this.value);
              currentLayerIndex = layerIndex;
            }

            function mergeLayers() {
              if (currentLayerIndex < layers.length - 1) {
                const currentLayer = layers[currentLayerIndex];
                const belowLayer = layers[currentLayerIndex + 1];
                const currentLayerCtx = currentLayer.getContext('2d');
                currentLayerCtx.drawImage(belowLayer, 0, 0);
                layers.splice(currentLayerIndex + 1, 1);
                deleteLayerOption(currentLayerIndex + 1);
                deleteLayerContainer(currentLayerIndex + 1);
                redrawLayers();
                saveHistory();
              }
            }

            function moveLayerUp() {
              if (currentLayerIndex > 0) {
                swapLayers(currentLayerIndex, currentLayerIndex - 1);
                currentLayerIndex--;
                updateLayerSelect();
                redrawLayers();
              }
            }

            function moveLayerDown() {
              if (currentLayerIndex < layers.length - 1) {
                swapLayers(currentLayerIndex, currentLayerIndex + 1);
                currentLayerIndex++;
                updateLayerSelect();
                redrawLayers();
              }
            }

            function swapLayers(index1, index2) {
              const temp = layers[index1];
              layers[index1] = layers[index2];
              layers[index2] = temp;
              saveHistory();
            }

            function updateLayerSelect() {
              const layerSelect = document.getElementById('layer-select');
              layerSelect.value = currentLayerIndex;
            }

            function deleteLayerOption(layerIndex) {
              const layerSelect = document.getElementById('layer-select');
              layerSelect.remove(layerIndex);
            }

            function deleteLayerContainer(layerIndex) {
              const layerContainer = document.getElementById(`layer-${layerIndex}-container`);
              layerContainer.remove();
            }

            function drawCurrentCanvas() {
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              layers.forEach((layer, index) => {
                const layerCheckbox = document.querySelector(`#layer-${index}-checkbox`);
                if (layerCheckbox.checked) {
                  ctx.drawImage(layer, 0, 0);
                }
              });
            }

            function duplicateLayer() {
              const currentLayer = layers[currentLayerIndex];
              const newLayer = document.createElement('canvas');
              newLayer.width = currentLayer.width;
              newLayer.height = currentLayer.height;
              const newLayerCtx = newLayer.getContext('2d');
              newLayerCtx.drawImage(currentLayer, 0, 0);
              layers.splice(currentLayerIndex + 1, 0, newLayer);
              createLayerOption(currentLayerIndex + 1);
              addLayerToContainer(currentLayerIndex + 1);
              redrawLayers();
              saveHistory();
            }

            function createLayerOption(layerIndex) {
              const option = document.createElement('option');
              option.value = layerIndex;
              option.text = `Layer ${layerIndex + 1}`;
              document.getElementById('layer-select').appendChild(option);
            }

            function addLayerToContainer(layerIndex) {
              const layerContainer = document.createElement('div');
              layerContainer.id = `layer-${layerIndex}-container`;
              layerContainer.className = 'layer-container';
              const layerImage = document.createElement('img');
              layerImage.id = `layer-${layerIndex}-preview`;
              layerImage.src = layers[layerIndex].toDataURL();
              layerImage.className = 'layer-image';
              const layerCheckbox = document.createElement('input');
              layerCheckbox.type = 'checkbox';
              layerCheckbox.className = 'layer-checkbox';
              layerCheckbox.id = `layer-${layerIndex}-checkbox`;
              layerCheckbox.checked = true;
              layerCheckbox.addEventListener('input', drawCurrentCanvas);
              const layerLabel = document.createElement('label');
              layerLabel.innerText = `Layer ${layerIndex + 1}, `;
              layerLabel.appendChild(layerImage);
              layerLabel.appendChild(layerCheckbox);
              layerContainer.appendChild(layerLabel);
              layersContainer.appendChild(layerContainer);
              layerContainer.addEventListener('click', () => {
                currentLayerIndex = layerIndex;
                document.getElementById('layer-select').value = layerIndex;
                const allLayerContainers = document.getElementsByClassName('layer-container');
                for (let i = 0; i < allLayerContainers.length; i++) {
                  allLayerContainers[i].classList.remove('highlighted');
                }
                layerContainer.classList.add('highlighted');
                curserCtx.clearRect(0,0,cWidth,cHeight);
                curserCtx.drawImage(layers[currentLayerIndex],0,0);
              });
              if (layerIndex === 0) {
                layerContainer.classList.add('highlighted');
              }
            }

            function undo() {
              if (historyIndex > 1) {
                historyIndex--;
                const history = layerHistory[historyIndex];
                layers = history.map((dataURL) => {
                  const layer = document.createElement('canvas');
                  layer.width = canvas.width;
                  layer.height = canvas.height;
                  const img = new Image();
                  img.src = dataURL;
                  layer.getContext('2d').drawImage(img, 0, 0);
                  return layer;
                });
                redrawLayers();
              }
            }

            function redo() {
              if (historyIndex < layerHistory.length - 1) {
                historyIndex++;
                const history = layerHistory[historyIndex];
                layers = history.map((dataURL) => {
                  const layer = document.createElement('canvas');
                  layer.width = canvas.width;
                  layer.height = canvas.height;
                  const img = new Image();
                  img.src = dataURL;
                  layer.getContext('2d').drawImage(img, 0, 0);
                  return layer;
                });
                redrawLayers();
              }
            }

            function saveHistory() {
              const history = layers.map((layer) => layer.toDataURL());
              layerHistory = layerHistory.slice(0, historyIndex + 1);
              layerHistory.push(history);
              historyIndex++;
            }

            function redrawLayers() {      
              const layerSelect = document.getElementById('layer-select');
              layerSelect.innerHTML = '';
              layersContainer.innerHTML = '';
              layers.forEach((layer, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.text = `Layer ${index + 1}`;
                layerSelect.appendChild(option);
                addLayerToContainer(index);
              });
              drawCurrentCanvas();
            }

            function changecorners(event){
              var mouseX = event.clientX - canvas.offsetLeft;
              var mouseY = event.clientY - canvas.offsetTop;
              var a = mouseX-x;
              var b = mouseY-y;
              if(a<0)a=a*(-1);
              if(b<0)b=b*(-1);
              var r= Math.max(a,b)/2;
              var alpha = 360/corners;
              clicks = null;
              clicks = [];
              for(var i=0; i < corners+1; i++) { 
                clicks.push({
                  _x: (mouseX+x)/2  +  Math.cos(i*alpha * Math.PI / 180)*r,
                  _y: (mouseY+y)/2  +  Math.sin(i*alpha * Math.PI / 180)*r
                });
              }
            }

            function changecornerswoe(event){
              var mouseX = f_x2;
              var mouseY = f_y2;
              var a = mouseX-x;
              var b = mouseY-y;
              if(a<0)a=a*(-1);
              if(b<0)b=b*(-1);
              var r= Math.max(a,b)/2;
              var alpha = 360/corners;
              clicks = null;
              clicks = [];
              for(var i=0; i < corners+1; i++) { 
                if(i<corners+1){
                  clicks.push({
                  _x: (mouseX+x)/2  +  Math.cos(i*alpha * Math.PI / 180)*r,
                  _y: (mouseY+y)/2  +  Math.sin(i*alpha * Math.PI / 180)*r
                });     
                }
              }
            }

            function clearCanvas() {
              ctx.putImageData(actions[0].data, 0, 0);
              saveHistory();
            }

            function drawTextCurser(e){
              const history = layerHistory[historyIndex];
                  layers = history.map((dataURL) => {
                      const layer = document.createElement('canvas');
                      layer.width = canvas.width;
                      layer.height = canvas.height;
                      const img = new Image();
                      img.src = dataURL;
                      layer.getContext('2d').drawImage(img, 0, 0);
                      return layer;
                    });
              tempCtx.clearRect(0,0,cWidth,cHeight);
              tempCtx.drawImage(tempcanvas,0,0);
              var d = document.getElementById("textcursor");
              d.style.position = "absolute";
              let cordstrg =  curserX+"px";
              d.style.left = cordstrg;
              cordstrg = curserY-TextSizeSlider.value+"px";
              d.style.top = cordstrg;
              cordstrg= TextSizeSlider.value+"px";
              d.style.height= cordstrg;
              let strg = TextSizeSlider.value +"px "+selectedFont;
              tempCtx.font= strg;
              tempCtx.fillStyle =selectedColor;
              tempCtx.fillText(TextInput.value, lastX, lastY);
              
              ctx.clearRect(0, 0, canvas.width, canvas.height);
                    layers.forEach((layer, index) => {
                      const layerCtx = layer.getContext('2d');
                      const layerCheckbox = document.querySelector(`#layer-${index}-checkbox`);
                      if (layerCheckbox.checked) {
                        if(index==currentLayerIndex){
                          layerCtx.drawImage(tempCanvas,0,0);
                        }
                      }
                    });
                    const layerPreviewImage = document.querySelector(`#layer-${currentLayerIndex}-preview`);
                      layerPreviewImage.src = layers[currentLayerIndex].toDataURL();
                      drawCurrentCanvas();
            }
            

            function drawforms(event){
              if(modeForms){
                if(form_type=="f"){
                  tempCtx.strokeStyle='#00000000';
                  tempCtx.fillStyle =forms_c2;
                }
                else if(form_type=="o"){
                  tempCtx.strokeStyle=forms_c1;
                  tempCtx.fillStyle ='#00000000';
                }
                else if(form_type=="of"){
                  tempCtx.strokeStyle=forms_c1;
                  tempCtx.fillStyle =forms_c2;
                }
                if(isResizing){
                  const history = layerHistory[historyIndex];
                  layers = history.map((dataURL) => {
                      const layer = document.createElement('canvas');
                      layer.width = canvas.width;
                      layer.height = canvas.height;
                      const img = new Image();
                      img.src = dataURL;
                      layer.getContext('2d').drawImage(img, 0, 0);
                      return layer;
                    });


                    if(selectedform=="forms_line"){
                      var mouseX = event.clientX - canvas.offsetLeft;
                      var mouseY = event.clientY - canvas.offsetTop;
                        tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                        tempCtx.beginPath();
                        tempCtx.moveTo(x, y);
                        tempCtx.lineTo(mouseX, mouseY);
                    }
                    else if(selectedform=="forms_tri"){
                      var mouseX = event.clientX - canvas.offsetLeft;
                      var mouseY = event.clientY - canvas.offsetTop;

                        width = mouseX - x;
                        height = mouseY - y;
                        tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                        tempCtx.beginPath();
                        if(!isrectangular){
                          tempCtx.moveTo(x, y);
                          tempCtx.lineTo(x, mouseY);
                          tempCtx.lineTo(mouseX, mouseY);
                        }
                        else{
                          tempCtx.moveTo((x+mouseX)/2, y);
                          tempCtx.lineTo(x, mouseY);
                          tempCtx.lineTo(mouseX, mouseY);
                        }
                      
                    }
                    else if(selectedform=="forms_rect"){
                      var mouseX = event.clientX - canvas.offsetLeft;
                      var mouseY = event.clientY - canvas.offsetTop;

                        width = mouseX - x;
                        height = mouseY - y;
                        tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                        tempCtx.beginPath();
                        tempCtx.roundRect(x, y, width, height,f_cornersSlider.value);//(0°rounded corners)
                        f_x2=mouseX;
                        f_y2=mouseY;
                      
                    }
                    else if(selectedform=="forms_circle"){
                      var mouseX = event.clientX - canvas.offsetLeft;
                      var mouseY = event.clientY - canvas.offsetTop;

                        tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                        tempCtx.beginPath();
                        //mathe abvoten?
                        var a = mouseX-x;
                        var b = mouseY-y;
                        if(a<0)a=a*(-1);
                        if(b<0)b=b*(-1);
                        var r= Math.max(a,b)/2;
                        tempCtx.arc((x+mouseX)/2, (y+mouseY)/2, r, 0, 360,false);//(clockwise)
                      
                    }
                    else if(selectedform=="forms_elypse"){
                      var mouseX = event.clientX - canvas.offsetLeft;
                      var mouseY = event.clientY - canvas.offsetTop;

                        tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                        tempCtx.beginPath();
                        //mathe abschaffen?
                        var a = mouseX-x;
                        var b = mouseY-y;
                        if(a<0)a=a*(-1);
                        if(b<0)b=b*(-1);
                        tempCtx.ellipse((x+mouseX)/2, (y+mouseY)/2, a/2, b/2, 0, 0, 360);
                      
                    }
                    else if(selectedform=="forms_polygon"){
                      var mouseX = event.clientX - canvas.offsetLeft;
                      var mouseY = event.clientY - canvas.offsetTop;
                      changecorners(event);
                      tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                      var a = mouseX-x;
                      var b = mouseY-y;
                      if(a<0)a=a*(-1);
                      if(b<0)b=b*(-1);
                      var r= Math.max(a,b)/2;
                      tempCtx.beginPath();
                      tempCtx.moveTo(clicks[0]._x,clicks[0]._y);//(clockwise)
                      for(var i=1; i < clicks.length; i++) { 
                        tempCtx.lineTo(clicks[i]._x,clicks[i]._y);
                      }
                      f_x2=mouseX;
                      f_y2=mouseY;
                      
                    }
                    else if(selectedform=="forms_heart"){
                      var mouseX = event.clientX - canvas.offsetLeft;
                      var mouseY = event.clientY - canvas.offsetTop;

                        tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                        var a = mouseX-x;
                        var b = mouseY-y;
                        var k =x;
                        var d=b;//height
                        var v = a;//width
                        tempCtx.beginPath();
                        tempCtx.moveTo(k, k + d / 4);
                        tempCtx.quadraticCurveTo(k        , k        , k + v / 4  , k);
                        tempCtx.quadraticCurveTo(k + v / 2, k        , k + v / 2  , k + d / 4);
                        tempCtx.quadraticCurveTo(k + v / 2, k        , k + v * 3/4, k);
                        tempCtx.quadraticCurveTo(k + v    , k        , k + v      , k + d / 4);
                        tempCtx.quadraticCurveTo(k + v    , k + d / 2, k + v * 3/4, k + d * 3/4);
                        tempCtx.lineTo(			     k + v / 2, k + d);
                        tempCtx.lineTo(			     k + v / 4, k + d * 3/4);
                        tempCtx.quadraticCurveTo(k        , k + d / 2, k          , k + d / 4);
                      
                    }
                    tempCtx.closePath();
                    tempCtx.fill();
                    tempCtx.stroke();

                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    layers.forEach((layer, index) => {
                      const layerCtx = layer.getContext('2d');
                      const layerCheckbox = document.querySelector(`#layer-${index}-checkbox`);
                      if (layerCheckbox.checked&&index==currentLayerIndex) {
                        layerCtx.drawImage(tempCanvas,0,0);
                      }
                    });
                    const layerPreviewImage = document.querySelector(`#layer-${currentLayerIndex}-preview`);
                      layerPreviewImage.src = layers[currentLayerIndex].toDataURL();
                      drawCurrentCanvas();
                  }
                }

            }

            function draw(e) {
              if (!isDrawing) return;
              if(isEraseMode){
                const currentLayer = layers[currentLayerIndex];
                if (!currentLayer) return;
                const layerCtx = currentLayer.getContext('2d');
                layerCtx.save(); 
                layerCtx.beginPath();
                layerCtx.arc(e.offsetX, e.offsetY, brushSize/2, 0, 2*Math.PI); 
                layerCtx.clip();
                layerCtx.clearRect(0, 0, canvas.width, canvas.height); 
                layerCtx.restore(); 
                [lastX, lastY] = [e.offsetX, e.offsetY];
                const layerPreviewImage = document.querySelector(`#layer-${currentLayerIndex}-preview`);
                layerPreviewImage.src = currentLayer.toDataURL();
                drawCurrentCanvas();
              }
              else{
                if (isRainbowMode) {
                  const hue = Math.atan2(e.offsetY - lastY, e.offsetX - lastX) / (2 * Math.PI) + 0.5;
                  ctx.strokeStyle = `hsl(${hue * 360}, 100%, 50%)`;
                }
                else {
                  ctx.strokeStyle = selectedColor;
                }
                const currentLayer = layers[currentLayerIndex];
                if (!currentLayer) return;
                const layerCtx = currentLayer.getContext('2d');
                layerCtx.strokeStyle = ctx.strokeStyle;
                layerCtx.lineJoin = 'round';
                layerCtx.lineCap = 'round';
                layerCtx.lineWidth = brushSize;
                layerCtx.beginPath();
                layerCtx.globalAlpha = brushOpacity/255;
                layerCtx.moveTo(lastX, lastY);
                layerCtx.lineTo(e.offsetX, e.offsetY);
                layerCtx.stroke();
                [lastX, lastY] = [e.offsetX, e.offsetY];
                const layerPreviewImage = document.querySelector(`#layer-${currentLayerIndex}-preview`);
                layerPreviewImage.src = currentLayer.toDataURL();
                drawCurrentCanvas();
              }
            }

            function resetFilters(){
              hueSlider.value = 0;
              blurSlider.value = 0;
              contrastSlider.value = 100;
              exposureSlider.value = 0;
              brightnessSlider.value = 100;
              saturationSlider.value = 100;
              grayscaleSlider.value=0;
              tempCtx.clearRect(0, 0, canvas.width, canvas.height);
              TextSizeSlider.value=20;
              TextInput.value="";
              tempCtx.filter='none';
              ctx.filter='none';
            }

            function applyFilters() {
              const hue = document.getElementById("hue").value;
              const blur = document.getElementById("blur").value;
              const grayscale = document.getElementById("grayscale").value;
              const invert = document.getElementById("invert").value;
              const exposure = document.getElementById("exposure").value;
              const saturation = document.getElementById("saturation").value;
              const brightness = document.getElementById("brightness").value;
              const contrast = document.getElementById("contrast").value;
              const adjustedBrightness = brightness * Math.pow(2, exposure);
              const adjustedContrast = parseInt(contrast) + (exposure * 10);
              tempCtx.clearRect(0,0,cWidth,cHeight);
              tempCtx.filter = `hue-rotate(${hue}deg) saturate(${saturation}%) brightness(${adjustedBrightness}%) contrast(${adjustedContrast}%) blur(${blur}px) grayscale(${grayscale}%) invert(${invert}%)`;
              tempCtx.drawImage(curserCanvas,0,0);

              ctx.clearRect(0, 0, canvas.width, canvas.height);
              layers.forEach((layer, index) => {
                const layerCtx = layer.getContext('2d');
                const layerCheckbox = document.querySelector(`#layer-${index}-checkbox`);
                if (layerCheckbox.checked) {

                  if(index==currentLayerIndex){
                    layerCtx.clearRect(0, 0, canvas.width, canvas.height);
                    layerCtx.drawImage(tempCanvas,0,0);
                  }
                  
                }
              });
              const layerPreviewImage = document.querySelector(`#layer-${currentLayerIndex}-preview`);
                layerPreviewImage.src = layers[currentLayerIndex].toDataURL();
                drawCurrentCanvas();
            }

            function downloadCanvas() {
              const link = document.createElement('a');
              link.download = 'canvas.png';
              link.href = canvas.toDataURL();
              link.click();
            }
            
          //algorithm from https://ben.akrin.com/an-html5-canvas-flood-fill-that-doesnt-kill-the-browser/  #4 
            function flood_fill( original_x, original_y, color ) {
                const currentLayer = layers[currentLayerIndex];
                const currentLayerCtx = currentLayer.getContext('2d');
                original_color = currentLayerCtx.getImageData( original_x, original_y, 1, 1 ).data ;
                original_color = { r:original_color[0],
                                   g:original_color[1],
                                   b:original_color[2],
                                   a:original_color[3] } ;
                x = original_x ;
                y = original_y ;
                boundary_pixels = currentLayerCtx.getImageData( 0, 0, canvas.width, canvas.height ) ;
                linear_cords = (y * canvas.width + x) * 4 ;
                var done = false ;
                while( y>=0 && !done ) {
                    var new_linear_cords = ( (y-1) * canvas.width + x ) * 4 ;
                    if( boundary_pixels.data[new_linear_cords]==original_color.r &&
                        boundary_pixels.data[new_linear_cords+1]==original_color.g &&
                        boundary_pixels.data[new_linear_cords+2]==original_color.b &&
                        boundary_pixels.data[new_linear_cords+3]==original_color.a ) {
                        y = y - 1 ;
                        linear_cords = new_linear_cords ;
                    } else {
                        done = true ;
                    }
                }
                var path = [{x:x, y:y}] ;
                var first_iteration = true ;
                var iteration_count = 0 ;
                var orientation = 1 ; // 0:^, 1:<-, 2:v, 3:->
                while( !(path[path.length-1].x==path[0].x && path[path.length-1].y==path[0].y) || first_iteration ) {
                    iteration_count++ ;
                    first_iteration = false ;
                    var got_it = false ;
                    if( path.length>=2 ) {
                        if( path[path.length-1].y-path[path.length-2].y<0 ) {
                            orientation = 0 ;
                        } else if( path[path.length-1].x-path[path.length-2].x<0 ) {
                            orientation = 1 ;
                        } else if( path[path.length-1].y-path[path.length-2].y>0 ) {
                            orientation = 2 ;
                        } else if( path[path.length-1].x-path[path.length-2].x>0 ) {
                            orientation = 3 ;
                        } else {
                        }
                    }
                    for( var look_at=0 ; !got_it && look_at<=3 ; look_at++ ) {
                        var both = (orientation + look_at) % 4 ;
                        if( both==0 ) {
                            if( !got_it && (x+1)<canvas.width ) {
                                linear_cords = (y * canvas.width + (x+1)) * 4 ;
                                if( boundary_pixels.data[linear_cords]==original_color.r &&
                                    boundary_pixels.data[linear_cords+1]==original_color.g &&
                                    boundary_pixels.data[linear_cords+2]==original_color.b &&
                                    boundary_pixels.data[linear_cords+3]==original_color.a ) {
                                    got_it = true ;
                                    x = x + 1 ;
                                }
                            }
                        } else if( both==1 ) {
                            if( !got_it && (y-1)>=0 ) {
                                linear_cords = ((y-1) * canvas.width + x) * 4 ;
                                if( boundary_pixels.data[linear_cords]==original_color.r &&
                                    boundary_pixels.data[linear_cords+1]==original_color.g &&
                                    boundary_pixels.data[linear_cords+2]==original_color.b &&
                                    boundary_pixels.data[linear_cords+3]==original_color.a ) {
                                    got_it = true ;
                                    y = y - 1 ;
                                }
                            }
                        } else if( both==2 ) {
                            if( !got_it && (x-1)>=0 ) {
                                linear_cords = (y * canvas.width + (x-1)) * 4 ;
                                if( boundary_pixels.data[linear_cords]==original_color.r &&
                                    boundary_pixels.data[linear_cords+1]==original_color.g &&
                                    boundary_pixels.data[linear_cords+2]==original_color.b &&
                                    boundary_pixels.data[linear_cords+3]==original_color.a ) {
                                    got_it = true ;
                                    x = x - 1 ;
                                }
                            }
                        } else if( both==3 ) {
                            if( !got_it && (y+1)<canvas.height ) {
                                linear_cords = ((y+1) * canvas.width + x) * 4 ;
                                if( boundary_pixels.data[linear_cords]==original_color.r &&
                                    boundary_pixels.data[linear_cords+1]==original_color.g &&
                                    boundary_pixels.data[linear_cords+2]==original_color.b &&
                                    boundary_pixels.data[linear_cords+3]==original_color.a ) {
                                    got_it = true ;
                                    y = y + 1 ;
                                }
                            }
                        }
                    }
                    if( got_it ) {
                        path.push( {x:x, y:y} ) ;
                    }
                }
                draw_quadratic_curve( path, currentLayerCtx, color, 1, color ) ;
            }
            function draw_quadratic_curve( path, currentLayerCtx, color, thickness, fill_color ) {
                color = "rgba( " + color.r + "," + color.g + ","+ color.b + ","+ color.a + ")" ;
                fill_color = "rgba( " + fill_color.r + "," + fill_color.g + ","+ fill_color.b + ","+ fill_color.a + ")" ;
                currentLayerCtx.strokeStyle = color ;
                currentLayerCtx.fillStyle = fill_color ;
                currentLayerCtx.lineWidth = thickness ;
                currentLayerCtx.lineJoin = "round" ;
                currentLayerCtx.lineCap = "round" ;
                if( path.length>0 ) { // just in case
                    if( path.length<3 ) {
                        var b = path[0] ;
                        currentLayerCtx.beginPath() ;
                        currentLayerCtx.arc( b.x, b.y, currentLayerCtx.lineWidth / 2, 0, Math.PI * 2, !0 ) ;
                        currentLayerCtx.fill() ;
                        currentLayerCtx.closePath();
                    } else {
                      currentLayerCtx.beginPath() ;
                      currentLayerCtx.moveTo( path[0].x, path[0].y ) ;
                        for( var i = 1; i<path.length-2; i++ ) {
                            var c = (path[i].x + path[i + 1].x) / 2 ;
                            var d = (path[i].y + path[i + 1].y) / 2 ;
                            currentLayerCtx.quadraticCurveTo( path[i].x, path[i].y, c, d ) ;
                        }
                        currentLayerCtx.quadraticCurveTo( path[i].x, path[i].y, path[i + 1].x, path[i + 1].y ) ;
                        currentLayerCtx.stroke() ;
                    }
                }
                if( fill_color!==false ) {
                  currentLayerCtx.fill() ;
                }
            }
            function color_to_rgba( color ) {
                if( color[0]=="#" ) { // hex notation
                    color = color.replace( "#", "" ) ;
                    var bigint = parseInt(color, 16);
                    var r = (bigint >> 16) & 255;
                    var g = (bigint >> 8) & 255;
                    var b = bigint & 255;
                    return {r:r,
                            g:g,
                            b:b,
                            a:255} ;
                } else if( color.indexOf("rgba(")==0 ) { // already in rgba notation
                    color = color.replace( "rgba(", "" ).replace( " ", "" ).replace( ")", "" ).split( "," ) ;
                    return {r:color[0],
                            g:color[1],
                            b:color[2],
                            a:color[3]*255} ;
                }else if(color.indexOf("rgb(")==0){//in rgb notation
                  color = color.replace( "rgb(", "" ).replace( " ", "" ).replace( ")", "" ).split( "," ) ;
                  return {r:color[0],
                            g:color[1],
                            b:color[2],
                            a:255} ;
                } else {
                    console.error( "warning: can't convert color to rgba: " + color ) ;
                    return {r:0,
                            g:0,
                            b:0,
                            a:0} ;
                }
            }
          //dark-mode
          function changecolor(){
            document.body.classList.toggle("dark-mode");
            var element = document.getElementById("myDIV1");
            element.classList.toggle("background-1-dark");
            element=document.getElementById("myDIV2");
            element.classList.toggle("text-other-dark")
            const toggle = document.getElementById('toggle-mode');


            localStorage.setItem('mode', document.body.classList.contains('dark-mode') ? 'dark' : 'light');

          }
          window.onload = function() {
              const toggle = document.getElementById('toggle-mode');
              const mode = localStorage.getItem('mode');
              toggle.checked = mode === 'dark';
              if (mode === 'dark') {
                  changecolor();
              }
          };
          </script>
    </body>
</html>